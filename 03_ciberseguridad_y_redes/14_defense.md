# üõ°Ô∏è Gu√≠a de Seguridad Digital: Defensa en Profundidad y Zero Trust

## üß† Filosof√≠a de Seguridad

La seguridad no es un producto, es un proceso. Cada capa a√±adida multiplica exponencialmente la resistencia del sistema. Un atacante debe comprometer TODAS las capas para tener √©xito. La filosof√≠a Zero Trust se basa en no confiar en nada por defecto y verificar siempre.

### Principios Clave
*   **No confiar por defecto**: Autenticaci√≥n para cada dispositivo y usuario.
*   **Acceso m√≠nimo necesario**: Limitar permisos por dispositivo.
*   **Segmentaci√≥n de red**: Separar dispositivos por funci√≥n.
*   **Monitoreo continuo**: Detectar actividad sospechosa.
*   **Autenticaci√≥n fuerte**: Verificaci√≥n constante de identidad.

---

## üß± Arquitectura de Seguridad: Modelo de Capas

Una buena arquitectura de seguridad se basa en la defensa en profundidad, donde m√∫ltiples capas de seguridad protegen los activos.

```mermaid
graph TD
    A[Hardware Hardening] --> B[OS Hardening]
    B --> C[Network Perimeter]
    C --> D[Basic Encryption]
    D --> E[Secure Communications]
```

### Arquitectura Final Tipo "Dark Army"

```mermaid
graph TD
    subgraph Internet Hostil
        A[Internet]
    end

    subgraph Per√≠metro
        B[ISP Modem en modo Bridge] --> C{üõ°Ô∏è pfSense Firewall + IDS/IPS};
    end

    subgraph Red Interna Segmentada
        C --> D[üîÄ Managed Switch];
        D --> V10[VLAN 10: Management];
        D --> V20[VLAN 20: Trabajo Confiable];
        D --> V30[VLAN 30: IoT No Confiable];
        D --> V40[VLAN 40: Invitados Aislados];
        D --> V50[VLAN 50: Honeypots & Trampas];
    end
    
    subgraph Endpoints y Servicios
        V10 --> E[üß† SIEM + Pi-hole];
        V20 --> F[üíª Workstations];
        V50 --> G[üçØ Honeypots];
    end

    subgraph Aislamiento en Workstation
        F --> H[Qubes OS];
        H --> I[VM de Trabajo];
        H --> J[VM de Navegaci√≥n An√≥nima - Whonix];
        H --> K[VM de Vault - KeePassXC];
    end

    subgraph Almacenamiento y Recuperaci√≥n
        L[üíæ Backups Offline Cifrados]
    end

    style L fill:#444,stroke:#000,stroke-width:2px
```

---

## üñ•Ô∏è Dominio 1: Infraestructura y Sistema Base

### Sistemas Operativos Seguros

| Sistema Operativo | Caracter√≠stica Principal | Uso Ideal | Persistencia | Requiere Instalaci√≥n |
|---|---|---|---|---|
| **Qubes OS** | Aislamiento total por VM | Seguridad extrema, compartimentalizaci√≥n | S√≠ | Instalaci√≥n dedicada |
| **Tails OS** | No guarda datos, todo pasa por Tor | Activismo, periodismo, navegaci√≥n an√≥nima | Opcional | USB booteable |
| **Whonix** | VM dividida en Gateway (Tor) y Workstation | Anonimato en entorno virtualizado | S√≠ | VirtualBox / KVM |
| **GrapheneOS** | Android hardened, sin Google tracking | M√≥vil seguro | S√≠ | Pixel |
| **CalyxOS** | Android privado con microG | M√≥vil seguro | S√≠ | Pixel |
| **PureOS (Live)** | Basado en Debian, enfocado en privacidad | Uso general con enfoque √©tico | S√≠ | USB o disco |

### Virtualizaci√≥n y Sandboxing

| Herramienta | Plataforma | Uso B√°sico | Prop√≥sito |
|---|---|---|---|
| **VirtualBox** | Win/Linux/macOS | Crear VMs para aislamiento de tareas, snapshots, red interna. | Laboratorio controlado |
| **KVM / QEMU** | Linux | Virtualizaci√≥n nativa, ideal para servidores y entornos productivos. | Virtualizaci√≥n de alto rendimiento |
| **Firejail** | Linux | `firejail firefox` | Aislar apps por perfil |
| **Flatpak** | Linux | `flatpak run org.mozilla.firefox` | Contenedor seguro |
| **Windows Sandbox**| Windows Pro/Ent | Ejecutar entorno aislado temporal | Pruebas seguras |

### Gu√≠a de Instalaci√≥n y Uso de Herramientas Clave

#### Qubes OS
- **Descarga**: [qubes-os.org/downloads](https://www.qubes-os.org/downloads/)
- **Instalaci√≥n**: [Gu√≠a paso a paso con capturas](https://computingforgeeks.com/install-qubes-os-step-by-step-with-screenshots/)
- **Uso b√°sico**: Aislamiento por qubes (VMs), cada uno con prop√≥sito distinto. Ideal para tareas separadas como navegaci√≥n, pentesting, correo.

#### Tails OS
- **Descarga**: [tails.net/install](https://tails.net/install/)
- **Instalaci√≥n**: USB booteable con Etcher o Rufus. [Gu√≠a oficial](https://tails.net/install/windows/)
- **Uso b√°sico**: Navegaci√≥n an√≥nima por Tor, no deja rastros en el sistema. Ideal para sesiones temporales.

#### Whonix
- **Descarga**: [whonix.org/wiki/Download](https://www.whonix.org/wiki/Download)
- **Instalaci√≥n**: Importar Gateway y Workstation en VirtualBox. [Gu√≠a detallada](https://www.techiemike.com/a-step-by-step-guide-to-setting-up-whonix-for-enhanced-internet-privacy/)
- **Uso b√°sico**: Todo el tr√°fico pasa por Tor. Gateway maneja red, Workstation ejecuta apps.

#### GrapheneOS
- **Descarga**: [grapheneos.org/install](https://grapheneos.org/install/)
- **Instalaci√≥n**: WebUSB installer desde navegador Chromium. Solo para dispositivos Pixel compatibles.
- **Uso b√°sico**: Android hardened, sin Google. Auditor, Vanadium, control granular de permisos.

---

## üåê Dominio 2: Per√≠metro de Red y Conectividad

### Firewall

| Herramienta | Nivel | Uso B√°sico |
|---|---|---|
| **UFW** | B√°sico | `sudo ufw default deny incoming` |
| **pfSense** | Avanzado | Firewall completo, NAT, VPN, VLAN, reglas granulares. |
| **OpenWRT** | Avanzado | Router personalizado, SPAN port, VLAN, QoS, firewall extendido. |

### VPN y DNS

| Elemento | Recomendaci√≥n M√°xima Seguridad | Justificaci√≥n T√©cnica |
|---|---|---|
| **VPN** | Mullvad / ProtonVPN / VPN propio en VPS | Sin logs, IP din√°mica, t√∫nel cifrado |
| **DNS Seguro** | DNSCrypt / DoH con NextDNS o Pi-hole | Evita filtrado ISP y rastreo por DNS |
| **Red WiFi** | WPA3, SSID oculto, MAC filtering | Reduce vectores de ataque locales |

### Gu√≠a de Instalaci√≥n y Uso de Herramientas Clave

#### pfSense
- **Descarga**: [pfsense.org/download](https://www.pfsense.org/download/)
- **Instalaci√≥n**: USB booteable, interfaz web. [Gu√≠a oficial](https://docs.netgate.com/pfsense/en/latest/install/install-walkthrough.html)
- **Uso b√°sico**: Firewall completo, NAT, VPN, VLAN, reglas granulares.

#### OpenWRT
- **Descarga**: [openwrt.org](https://openwrt.org/)
- **Instalaci√≥n**: Flashear firmware espec√≠fico del router. [Gu√≠a r√°pida](https://openwrt.org/docs/guide-quick-start/start)
- **Uso b√°sico**: Router personalizado, SPAN port, VLAN, QoS, firewall extendido.

#### Servidor de Red Virtualizado (VPN + Pi-hole)
- **Concepto**: En lugar de usar hardware dedicado como una Raspberry Pi, se puede lograr el mismo resultado con una m√°quina virtual (VM) ligera en un PC que est√© siempre encendido. Esto proporciona un servidor de red aislado para filtrar DNS y gestionar tu propia VPN sin coste de hardware adicional.
- **1. Crear la VM**: Usa VirtualBox o KVM para crear una VM con un sistema operativo ligero como **Debian Server** o **Ubuntu Server** (instalaci√≥n m√≠nima). Asigna recursos modestos (1-2 CPU, 1-2 GB RAM, 20 GB de disco).
- **2. Configurar la Red**: **CR√çTICO:** Configura el adaptador de red de la VM en modo **Puente (Bridged Adapter)**. Esto le dar√° a la VM su propia IP en tu red local, como si fuera un dispositivo f√≠sico. As√≠gnale una IP est√°tica dentro de la VM.
- **3. Instalar Software (dentro de la VM)**:
    - **Pi-hole Setup**: Sigue la gu√≠a oficial en [pi-hole.net](https://pi-hole.net/).
    - **VPN Setup**: Instala un servidor VPN. El script de [PiVPN para WireGuard](https://www.youtube.com/watch?v=DUpIOSbbvKk) funciona perfectamente en Debian/Ubuntu.
- **Uso b√°sico**: El resultado es el mismo: una red local filtrada, DNS seguro y un nodo VPN propio, todo corriendo de forma aislada en una VM.

---

## üîê Dominio 3: Criptograf√≠a y Gesti√≥n de Datos

### Cifrado de Archivos y Discos

| Herramienta | Sistema Compatible | Uso B√°sico | Nivel de Seguridad |
|---|---|---|---|
| **BitLocker** | Windows Pro/Ent | Activar ‚Üí Elegir PIN ‚Üí Guardar clave de recuperaci√≥n | Alto |
| **LUKS (dm-crypt)**| Linux | Cifrado completo con passphrase en arranque | Muy alto |
| **VeraCrypt** | Win/Linux/macOS | Crear volumen ‚Üí Montar ‚Üí Usar como disco normal | Alto |
| **GPG** | Win/Linux/macOS | `gpg --encrypt --recipient user file.txt` | Alto (manual) |

### Gestores de Contrase√±as y Autenticaci√≥n

| Elemento | Recomendaci√≥n M√°xima Seguridad | Justificaci√≥n T√©cnica |
|---|---|---|
| **Autenticaci√≥n** | 2FA f√≠sico (YubiKey), SSH Keys, contrase√±as √∫nicas | Evita phishing, acceso no autorizado |
| **Gestor de Contrase√±as** | KeePassXC / Bitwarden (self-hosted) | Vault cifrado, sin dependencia de terceros |

### Transferencia de Archivos

| Herramienta | Prop√≥sito Principal | Uso B√°sico | Nivel de Anonimato |
|---|---|---|---|
| **Magic Wormhole** | Transferencia segura de archivos | `wormhole send file.txt` ‚Üí `wormhole receive code` | Alto (peer-to-peer) |
| **OnionShare** | Compartir archivos y chat an√≥nimos | Arrastrar archivo ‚Üí Generar link `.onion` | Muy alto |
| **Syncthing** | Sincronizaci√≥n privada de archivos | A√±adir carpeta ‚Üí Compartir con otro dispositivo | Medio‚ÄìAlto |

---

## üïµÔ∏è Dominio 4: Navegaci√≥n y Anonimato

### Navegadores y Extensiones

| Elemento | Recomendaci√≥n M√°xima Seguridad | Justificaci√≥n T√©cnica |
|---|---|---|
| **Navegador Web** | Tor Browser / Firefox Hardened | Tor para anonimato, Firefox con configuraci√≥n estricta |
| **Extensiones clave** | uBlock Origin, NoScript, HTTPS Everywhere | Bloqueo de scripts, rastreadores y conexiones inseguras |

### Evasi√≥n de Fingerprinting

| T√©cnica | Descripci√≥n | Herramientas / Acciones Recomendadas |
|---|---|---|
| **Uniformidad de huella** | Usar configuraciones gen√©ricas para parecerse a muchos usuarios | Tor Browser (todos los usuarios comparten fingerprint) |
| **Spoofing activo** | Alterar manualmente User-Agent, WebGL, Canvas, etc. | `CanvasBlocker`, `User-Agent Switcher`, `Trace`, `Chameleon` |
| **Bloqueo de scripts** | Evitar que scripts recopilen datos del navegador | `NoScript`, `uBlock Origin`, `Privacy Badger` |
| **Navegadores modificados** | Usar navegadores dise√±ados para evadir fingerprinting | Brave (con fingerprint randomization), LibreWolf |

---

## üí¨ Dominio 5: Comunicaciones Seguras

### Mensajer√≠a y Correo

| Herramienta | Prop√≥sito Principal | Nivel de Anonimato | Requiere Tor |
|---|---|---|---|
| **Signal** | Mensajer√≠a cifrada | Alto (metadatos m√≠nimos) | No |
| **Session** | Mensajer√≠a an√≥nima sin n√∫mero | Muy alto | S√≠ (usa red onion propia) |
| **Element (Matrix)** | Mensajer√≠a descentralizada | Medio‚ÄìAlto | Opcional |
| **ProtonMail** | Correo electr√≥nico cifrado | Alto | No |
| **Tutanota** | Correo electr√≥nico cifrado | Alto | No |

---

## üõ°Ô∏è Dominio 6: Detecci√≥n, Respuesta y Defensa Activa

### Detecci√≥n de Intrusos

| Herramienta | Tipo | Uso B√°sico | Nivel de Visibilidad |
|---|---|---|---|
| **OSSEC** | HIDS (Linux/Win) | Monitorea logs, integridad, alertas por correo | Alta |
| **CrowdSec** | HIDS + Remediaci√≥n | Detecta ataques ‚Üí Bouncer bloquea IPs | Muy alta |
| **Auditd** | Linux | Monitorea syscalls, accesos, cambios cr√≠ticos | Alta |
| **Fail2Ban** | Linux | Detecta brute force ‚Üí bloquea IPs | Media |

### T√©cnicas Avanzadas de Protecci√≥n

| T√©cnica | Descripci√≥n | Herramienta Recomendada |
|---|---|---|
| **Honeytokens** | Archivos falsos para detectar acceso no autorizado | Crear `.docx` con alerta ‚Üí monitorear acceso |
| **Canary Files** | Archivos trampa con alertas autom√°ticas | OSSEC / Auditd / scripts personalizados |
| **Steganograf√≠a** | Ocultar datos dentro de im√°genes o audio | `steghide`, `zsteg`, `outguess` |
| **Red Team Local** | Simular ataques para probar defensas | `Metasploit`, `Caldera`, `Atomic Red Team` |
| **Control de Integridad**| Detectar cambios en archivos clave | `AIDE`, `Tripwire`, `OSSEC` |

---

## üß∞ Anexo: Herramientas y Scripts

### Scripts √ötiles

#### Crear volumen Veracrypt desde CLI
```bash
veracrypt --text --create /home/user/secure.hc \
  --size 500M --encryption AES --hash SHA-512 \
  --filesystem ext4 --password "TuClaveSegura"
```

#### Ejecutar Firefox en Firejail
```bash
firejail --private firefox
```

#### Ver alertas OSSEC
```bash
sudo tail -f /var/ossec/logs/alerts/alerts.log
```

#### Activar CrowdSec y ver IPs bloqueadas
```bash
sudo systemctl start crowdsec
sudo cscli decisions list
```

#### Crear red segmentada en OpenWRT
```bash
uci set network.iot=interface
uci set network.iot.proto='static'
uci set network.iot.ipaddr='192.168.50.1'
uci set network.iot.netmask='255.255.255.0'
uci commit network
/etc/init.d/network restart
```

#### Activar DNSCrypt en Linux
```bash
sudo apt install dnscrypt-proxy
sudo systemctl enable dnscrypt-proxy
sudo systemctl start dnscrypt-proxy
```

#### Fingerprint Evasion en Firefox (about:config)
```
privacy.resistFingerprinting ‚Üí true
webgl.disabled ‚Üí true
canvas.poisondata ‚Üí true
```

### Protocolos de Emergencia

#### Incident Response Playbook
```bash
#!/bin/bash
# Emergency incident response script

# 1. Network isolation
sudo iptables -P INPUT DROP
sudo iptables -P FORWARD DROP  
sudo iptables -P OUTPUT DROP
sudo iptables -A OUTPUT -p udp --dport 53 -j ACCEPT  # DNS only

# 2. Memory dump
sudo apt install volatility3
sudo dd if=/dev/mem of=/tmp/memory_dump.raw bs=1M

# 3. Disk imaging
sudo dd if=/dev/sda of=/external/disk_image.dd bs=4096 conv=noerror,sync

# 4. Log preservation
sudo tar -czf /external/logs_$(date +%Y%m%d_%H%M%S).tar.gz /var/log/

# 5. Process analysis
ps auxww > /external/processes.txt
netstat -tulnp > /external/network_connections.txt
lsof > /external/open_files.txt

# 6. Alert external monitoring
curl -X POST https://monitoring.domain.com/alert \
  -d "host=$(hostname)&incident=true&timestamp=$(date -Iseconds)"
```

#### Compromise Recovery
```bash
#!/bin/bash
# Automated compromise recovery

# 1. Kill suspicious processes
pkill -f "suspicious_binary"
pkill -f "known_malware"

# 2. Remove persistence mechanisms
crontab -l | grep -v "malicious_cron" | crontab -
find /etc/systemd/system/ -name "*.service" -exec grep -l "suspicious" {} \; | xargs rm

# 3. Reset credentials
passwd root
passwd $USER

# 4. Update and harden system
apt update && apt upgrade -y
apt autoremove --purge

# 5. Restore from clean backup
rsync -av /backup/clean_system/ / --exclude=/proc --exclude=/sys
```